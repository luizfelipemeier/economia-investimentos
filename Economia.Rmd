---
title: "DADOS DA ECONOMIA BRASILEIRA"
output: 
  bookdown::html_document2:
    theme: lumen
    split_by: "section"
    fig_width: 7
    fig_height: 6
    fig_caption: true
    number_sections: false 
    toc: yes
    toc_depth: 3
    toc_float:
        collapsed: no
        smooth_scroll: yes
    css: "style.css"
date: "Atualizado em `r paste0(format(Sys.Date(), format = '%d de '), c('janeiro', 'fevereiro', 'março', 'abril', 'maio', 'junho', 'julho', 'agosto', 'setembro', 'outubro', 'novembro', 'dezembro')[as.integer(format(Sys.Date(), format = '%m'))], format(Sys.Date(), format = ' de %Y'))`"
---
<!-- Inclua a biblioteca Font Awesome -->
<script src="https://kit.fontawesome.com/4e10600d5e.js" crossorigin="anonymous"></script>

<!-- Carregando fontes -->
<style>
  @@import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap');
</style>

<!-- Configuração do corpo do site -->
<style>
  body {
    text-align: justify;
    line-height: 1.5;
    font-family: 'Nunito Sans', sans-serif;
    
  }

/* Estilos para telas menores que 600 pixels de largura */
@media only screen and (max-width: 600px) {
  body {
    margin-left: 0; /* Remove o recuo na margem esquerda para telas menores */
    font-size: 2rem;
  }

  .dataTables_wrapper .dataTables_length,
  .dataTables_wrapper .dataTables_filter,
  .dataTables_wrapper .dataTables_info,
  .dataTables_wrapper .dataTables_paginate {
    font-size: 0.8rem;
    font-family: 'Nunito Sans', sans-serif;
    color: #636363;
  
  }
}

/* Estilos específicos para os títulos e parágrafos no conteúdo do documento */
  h1 {
    color: #0066cc; /* Azul para títulos de nível 1 */
    font-size: 4rem;
    font-family: "Bebas Neue", sans-serif;
  }
  
  h2 {
    color: #3399ff; /* Azul claro para títulos de nível 2 */
    font-size: 2rem;
    font-family: "Bebas Neue", sans-serif;
  }
  
  h3 {
    color: #66b2ff; /* Azul ainda mais claro para títulos de nível 3 */
    font-size: 2rem;
    font-family: "Bebas Neue", sans-serif;
  }
  
  p {
    font-size: 2rem;
    font-family: 'Nunito Sans', sans-serif;
  }

</style>

<!-- Configuração dual-frames -->
<style>
  .dual-frames {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
  }

  .frame {
    width: 48%;
    border: 0.2rem solid #ddd;
    padding: 0.8rem;
    box-sizing: border-box;
    font-size: 1rem; /* Exemplo de tamanho de fonte para os quadros usando unidades relativas */

    /* Adicione uma margem inferior para espaçamento entre os quadros */
    margin-bottom: 1em;
  }

  /* Estilos para telas menores que 600 pixels de largura */
  @media only screen and (max-width: 600px) {
  body {
    margin-left: 0; /* Remove o recuo na margem esquerda para telas menores */
    font-size: 2rem;
    }
  }
</style>

<!-- Centralizar as imagens -->
<style>
.img-responsive {
  max-width: 100%;
  height: auto;
}

.center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
</style>

<!-- Espacamento entre os titulos -->
<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

<!-- Incluir a biblioteca Lightbox2 -->
<link href="Images/lightbox2-2.11.4/dist/css/lightbox.css" rel="stylesheet" />
<script src="Images/lightbox2-2.11.4/dist/js/lightbox.js"></script>


```{r include=FALSE}

#carregando pacotes
library(bookdown)
library(sidrar)
library(devtools)
library(ipeadatar)
library(GetBCBData)
library(ggplot2)
library(gt)
library(gtExtras)
library(dplyr)
library(tidyverse)
library(dplyr)
library(lubridate)
library(knitr)
library(openxlsx)
library(kableExtra)
library(DT)
library(forcats)
library(plotly)
library(highcharter)
library(rvest)
library(RSelenium)
library(wdman)
library(netstat)
library(htmlTable)
library(fs)
library(htmltools)


```

# BRASIL

Dados referentes a economia brasileira. Dados para auxiliar a entender a conjuntura econômica do nosso país.
<div class="spacer"></div>

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

df.bcb <- gbcbd_get_series(id = 21774 ,
                       first.date = '1900-01-01',
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE) %>% 
  mutate(populacao = value * 1000)



hchart(df.bcb, "column", hcaes(x = ref.date, y = populacao)) %>%
   hc_yAxis(
    title = list(text = "População"),
    labels = list(
      formatter = JS(
        "function() { 
          if (this.value >= 1e6) {
            return Highcharts.numberFormat(this.value / 1e6, 0) + ' MM';
          } else {
            return Highcharts.numberFormat(this.value, 0, '.', ',');
          }
        }"
      )
    )
  ) %>%
  hc_xAxis(title = list(text = "Data")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "População brasileira") %>%
  hc_subtitle(text = "Fonte: IBGE") %>%
  hc_tooltip(
    useHTML = TRUE,
    headerFormat = "<span style='font-size:10px'>{point.key}</span><table>",
    pointFormat = "<tr><td style='color:{point.color};padding:0'>{series.name}: </td><td style='padding:0'><b>{point.y:,.0f} pessoas</b></td></tr>",
    footerFormat = "</table>",
    shared = TRUE,
    valueDecimals = 2
  )


```
<div class="spacer"></div>

## PRODUTO {.toc}
<div class="spacer"></div>

As métricas de produto buscam mensurar quantidade de riqueza gerada em um país, estado ou cidade, dentro de um período de tempo.
<div class="spacer"></div>

### Produto Interno Bruto {.toc}
<div class="spacer"></div>

O Produto Interno Bruto (PIB - *GDP/Gross Domestic Product*) é a soma de todos os bens e serviços finais produzidos por um país, estado ou cidade, geralmente em um ano.

<div class="spacer"></div>
<div class="spacer"></div>
<div class="dual-frames">
<div class="frame">
*The Organisation for Economic Co-operation and Development ([OECD](https://en.wikipedia.org/wiki/OECD)) defines GDP as "an aggregate measure of production equal to the sum of the gross values added of all resident and institutional units engaged in production and services (plus any taxes, and minus any subsidies, on products not included in the value of their outputs)"*
</div>
<div class="frame">
*An [IMF](https://en.wikipedia.org/wiki/International_Monetary_Fund) publication states that, "GDP measures the monetary value of final goods and services—that are bought by the final user—produced in a country in a given period (say a quarter or a year)."*
</div>
</div>

<div class="spacer"></div>

Existem três metodologias de cálculo do PIB, sendo que teoricamente todas elas chegam ao mesmo valor final.
<div class="spacer"></div>

**Ótica da oferta ou produção**

Também conhecida como *método do valor adicionado*, calcula o montante que cada estágio da produção agrega ao produto. Primeiro estima-se o do *valor adicionado bruto* fabricado das diversas atividades econômicas.Posteriormente estima-se o valor do *consumo intermediário*, onde considera os custos dos bens e serviços utilizados para produzir os bens e serviços finais. Ademais, subtrai o valor doméstico bruto do valor intermediário. Por fim, *subtrai os valores dos impostos indiretos e soma os valores dos subsídios*. 
<div class="spacer"></div>

**Ótica da renda**

O método inicia com o somatório dos *salários, vencimentos e rendimentos* recebidos pelas atividades laborais, *juros e receitas* advindos de diversos investimentos, *aluguéis* referentes aos alugueis/arrendamentos de imóveis ou terras, *lucros corporativos* oriundos dos lucros das empresas e *lucros líquidos* das transferências dos lucros das empresas para as pessoas.
Este somatório resulta no rendimento doméstico líquido dos custos dos fatores.
Para chegar ao PIB, deve-se ainda considerar a *deprecisação do capital*, as *taxas de produção e importação* e os *subsídios* estatais. 
<div class="spacer"></div>

**Ótica do consumo**

Essa é a metologia mais divulgada onde o PIB é mesurado pela soma do *consumo (C)*, *investimento (I)*, *gastos do governo (G)* e *balança comercial (X-M)*. Por este método utiliza os preços de aquisição dos bens e serviços finais. Quando não realizada a venda, a contabilidade considera que o produtor comprou de si mesmo. 
<div class="spacer"></div>

*DADOS [BACEN SGS](https://www3.bcb.gov.br/sgspub/localizarseries/localizarSeries.do?method=prepararTelaLocalizarSeries)*

Oficialmente o IBGE calcula trimestralmente o PIB , entretanto, devido a utilização deste agregado econômico para formulação de políticas públicas e demais necessidades, o Departamento Econômico do Banco Central estima o PIB por meio da interpolação com dados já divulgados, realizando extrapolação do último valor divulgado do PIB Nominal, sofrendo revisões periódicas.
<div class="spacer"></div>

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

df.bcb <- gbcbd_get_series(id = 4192 ,
                       first.date = '1900-01-01',
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)

hchart(df.bcb, "line", hcaes(x = ref.date, y = value)) %>%
  hc_yAxis(title = list(text = "US$ milhões")) %>%
  hc_xAxis(title = list(text = "Data")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "PIB - acumulado dos últimos 12 meses") %>%
  hc_subtitle(text = "Fonte: BCB - Depec")  %>%
  hc_caption(text = "BCB SGS 4192") %>% 
  hc_tooltip(
    useHTML = TRUE,
    headerFormat = "<span style='font-size:10px'>{point.key}</span><table>",
    pointFormat = "<tr><td style='color:{point.color};padding:0'>{series.name}: </td><td style='padding:0'><b>{point.y:.0f} MM US$</b></td></tr>",
    footerFormat = "</table>",
    shared = TRUE,
    valueDecimals = 2
  )


```

<div class="spacer"></div>

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

df.bcb <- gbcbd_get_series(id = 21776 ,
                       first.date = '1900-01-01',
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)

hchart(df.bcb, "line", hcaes(x = ref.date, y = value)) %>%
  hc_yAxis(title = list(text = "US$ correntes",
                        labels = list(
      formatter = JS(
        "function() { 
          return Highcharts.numberFormat(this.value, 0, '.', ',');
        }"
          )
  ) )) %>%
  hc_xAxis(title = list(text = "Data")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "PIB per capita") %>%
  hc_subtitle(text = "Fonte: 	BCB-Depec")  %>% 
  hc_caption(text = "BCB SGS 21776")  %>%
  hc_tooltip(
    useHTML = TRUE,
    headerFormat = "<span style='font-size:10px'>{point.key}</span><table>",
    pointFormat = "<tr><td style='color:{point.color};padding:0'>{series.name}: </td><td style='padding:0'><b>{point.y:.0f} US$</b></td></tr>",
    footerFormat = "</table>",
    shared = TRUE,
    valueDecimals = 2
  )

```

<div class="spacer"></div>

```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))

## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

for (i in 7326:7329) {
  x <- bcb.sgs(i, '1900-01-01') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "PIB - taxa de variação real no ano", 
    "PIB agropecuária - taxa de variação real no ano",
    "PIB indústria - taxa de variação real no ano",
    "PIB serviços - taxa de variação real no ano")

df.bcb <- df.bcb %>%
  pivot_longer(cols = -data, names_to = "variavel", values_to = "valor")

## Plotando gráficos
hchart(df.bcb, "line", hcaes(x = data, y = valor, group = variavel)) %>%
  hc_title(text = "PIB - taxa de variação real no ano") %>%
  hc_subtitle(text = "Fonte: IBGE")  %>% 
  hc_caption(text = "BCB SGS 7326 | 7327 |7328 | 7329") %>%
  hc_subtitle(text = "Fonte: IBGE") %>%
  hc_xAxis(title = list(text = "Anos")) %>%
  hc_yAxis(title = list(text = "Variação % anual",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_legend(enabled = TRUE)


```

<div class="spacer"></div>

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

df.bcb <- gbcbd_get_series(id = 1207 ,
                       first.date = '1990-01-01',
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)

hchart(df.bcb, "column", hcaes(x = ref.date, y = value)) %>%
  hc_yAxis(title = list(text = "RS",
                        labels = list(
                          formatter = JS(
                            "function() { 
                              return Highcharts.numberFormat(this.value, 0, '.', ',');
                            }"
                          )
                        )
  )) %>%
  hc_xAxis(title = list(text = "Data")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "PIB - Preços correntes de 1990") %>%
  hc_subtitle(text = "Fonte: IBGE")  %>% 
  hc_caption(text = "BCB SGS 1207") %>%
  hc_tooltip(
    useHTML = TRUE,
    headerFormat = "<span style='font-size:10px'>{point.key}</span><table>",
    pointFormatter = JS(
      "function() {
        return '<tr><td style=\"color:' + this.color + ';padding:0\">' + this.series.name + ': </td>' +
               '<td style=\"padding:0\"><b>' + (this.y / 1e12).toFixed(2) + ' T R$</b></td></tr>';
      }"
    ),
    footerFormat = "</table>",
    shared = TRUE,
    valueDecimals = 2
  ) 

```
<div class="spacer"></div>

## MOEDA {.toc}



### Inflação {.toc .tabset .tabset-fade .tabset-pills} 

É o aumento generalizado e persistente do nível de preços de uma economia.

**Causas da inflação**

A inflação pode ter várias causas, que podem ser agrupadas em:

- Pressões de demanda
- Pressões de custos
- Inércia inflacionária
- Expectativas de inflação
<div class="spacer"></div>

**Consequências da inflação**

A inflação descontrolada gera incertezas importantes na economia, desestimulando o investimento e, assim, prejudicando o crescimento econômico. Os preços relativos ficam distorcidos, gerando várias ineficiências na economia. As pessoas e as firmas perdem noção dos preços relativos e, assim, fica difícil avaliar se algo está barato ou caro. A inflação afeta particularmente as camadas menos favorecidas da população, pois essas têm menos acesso a instrumentos financeiros para se defender da inflação.

Inflação mais alta também aumenta o custo da dívida pública, pois as taxas de juros da dívida pública têm de compensar não só o efeito da inflação mas também têm de incluir um prêmio de risco para compensar as incertezas associadas com a inflação mais alta.
<div class="spacer"></div>

**Por que a deflação é também indesejável?**

O Banco Central trabalha para manter a inflação baixa – não para que os preços declinem. A perspectiva de que os valores cobrados sejam relativamente estáveis ao longo do tempo, com inflação baixa e previsível, é importante para o planejamento de todos. Ao contrário do que possa parecer, preços em queda podem ser prejudiciais para o bom funcionamento da economia. Um comerciante poderá ter prejuízo se ganhar menos amanhã pelo estoque que fez hoje. As famílias e as empresas poderão adiar suas decisões de consumo e investimento se houver a perspectiva de que os preços serão mais baixos amanhã, deprimindo a atividade econômica.
<div class="spacer"></div>

**Metas para a inflação**

Inflação baixa, estável e previsível traz vários benefícios para a sociedade. A economia pode crescer mais, pois a incerteza na economia é menor, as pessoas podem planejar melhor seu futuro e as famílias não têm sua renda real corroída. Para alcançar esse objetivo, o Brasil adota o regime de metas para a inflação, que está em vigor desde 1999.

Esse regime tem sido exitoso no Brasil e no amplo conjunto de países que o adotam. Por esse sistema, os bancos centrais atuam para que a inflação efetiva esteja em linha com uma meta pré-estabelecida. Nesse sistema, a meta para a inflação é anunciada publicamente e funciona como uma âncora para as expectativas dos agentes sobre a inflação futura, permitindo que desvios da inflação em relação à meta sejam corrigidos ao longo do tempo.

No Brasil, a meta para a inflação é definida pelo Conselho Monetário Nacional (CMN) e cabe ao Banco Central (BC) adotar as medidas necessárias para alcançá-la. O índice de preços utilizado é o Índice Nacional de Preços ao Consumidor Amplo (IPCA), calculado pelo Instituto Brasileiro de Geografia e Estatística (IBGE). A meta se refere à inflação acumulada no ano. Por exemplo, a meta para 2023 é de uma inflação de 3,25%.

No desenho atual do sistema, o CMN define em junho a meta para a inflação de três anos-calendário à frente. Por exemplo, em junho de 2018, o CMN definiu a meta para 2021. Esse horizonte mais longo reduz incertezas e melhora a capacidade de planejamento das famílias, empresas e governo.

O sistema prevê ainda um intervalo de tolerância, também definido pelo CMN. Nos últimos anos, o CMN tem definido um intervalo de 1,5 ponto percentual (p.p.) para cima e para baixo. Por exemplo, no caso de 2025, a meta é de 3,00% e o intervalo é de 1,50% a 4,50%. Se a inflação ao final do ano se situar fora do intervalo de tolerância, o presidente do BC tem de divulgar publicamente as razões do descumprimento, por meio de carta aberta ao Ministro da Fazenda, presidente do CMN, contendo descrição detalhada das causas do descumprimento, as providências para assegurar o retorno da inflação aos limites estabelecidos e o prazo no qual se espera que as providências produzam efeito.

Em termos gerais, o regime de metas para a inflação envolve os seguintes elementos:

- Conhecimento público e prévio da meta para a inflação;
- Autonomia do banco central na adoção das medidas necessárias para o cumprimento da meta;
- Comunicação transparente e regular sobre os objetivos e justificativas das decisões da política monetária;
- Mecanismos de incentivo e responsabilização/prestação de contas para que a autoridade monetária cumpra a meta.

<div class="spacer"></div>
<div class="dual-frames">
<div class="frame">

<!--Usar biblioteca lightbox do java para criar o popup -->
  <a href="images/inflacao.png" data-lightbox="imagem" data-title="Fonte: [Banco Central do Brasil](https://www.bcb.gov.br/controleinflacao/metainflacao)">
    <img src="images/inflacao.png" alt="Imagem" class="img-responsive center" style="display: inline-block;">
  </a>
  
</div>
<div class="frame">

```{r include=FALSE}

driver <- rsDriver(browser = "firefox", port = free_port())

remDr <- driver$client

remDr$navigate("https://www.bcb.gov.br/controleinflacao/historicometas")

# Aguarda um curto período de tempo para garantir que a página seja carregada
Sys.sleep(5)

# Obtém o conteúdo HTML da página atual
page_content <- remDr$getPageSource()[[1]]

# Utilizar a função read_html do pacote rvest para analisar o HTML
page_html <- read_html(page_content)

# Encontrar o nó da tabela dentro do div com classe "table-responsive"
table_node <- page_html %>% html_node("div.table-responsive table")

# Extrair a tabela usando html_table
tabela <- html_table(table_node, fill = TRUE)

# Converter a tabela em um dataframe
df <- as.data.frame(tabela)

# Fecha a conexão com o Selenium
remDr$close()
driver$server$stop()



```
```{r echo=FALSE, warning=FALSE, message=FALSE, out.width='100%', fig.height=4}

if(nrow(df)>1){
        # Excluir a linha do ano 2003* e 2004*
        df <- df %>% filter(Ano != "2003*") %>% filter(Ano != "2004*")
        
        # Adicionar as novas linhas
        #nova_linha1 <- c("2003", "Resolução CMN nº 2.842", "28/6/2001", "3,25", "2", "1,25-5,25", "9,30")
        #nova_linha2 <- c("2003", "Resolução CMN nº 2.972", "27/6/2002", "4", "2,5", "1,5-6,5", "9,3")
        #nova_linha3 <- c("2004", "Resolução CMN nº 2.972", "27/6/2002", "3,75", "2,5", "1,25-6,25", "7,60")
        #nova_linha4 <- c("2004", "Resolução CMN nº 3.108", "25/6/2003", "5,5", "2,5", "3-8", "7,60")
        
        #df <- rbind(df, nova_linha1)
        #df <- rbind(df, nova_linha2)
        #df <- rbind(df, nova_linha3)
        #df <- rbind(df, nova_linha4)
        
        df <- arrange(df, desc(Ano))
        df <- df %>% filter(Ano>=2005)
        df <- df %>% separate("Intervalode tolerância (%)", 
                              into = c("Intervalo_inferior", 
                                       "Intervalo_superior"), 
                              sep = "-")
        df <- df %>% 
          mutate(Meta = `Meta (%)`)
        df <- df %>% select(Ano, Meta, Intervalo_inferior,Intervalo_superior)
        
        # Substituir vírgulas por pontos apenas nas colunas numéricas
        df <- df %>% 
          mutate(across(c(Meta, Intervalo_inferior, Intervalo_superior), ~as.numeric(gsub(",", ".", .))))
        # Numero problematico
        df$Meta[df$Ano == 2020] <- "4.0"
        
        # Criar o gráfico com highcharter
        plot_ly(df, x = ~Ano, y = ~Meta, name = "Meta", type = "scatter", mode = "lines") %>%
  add_trace(x = ~Ano, y = ~Intervalo_inferior, name = "Intervalo_inferior", type = "scatter", mode = "lines", line = list(dash = "dash"), showlegend = FALSE) %>%
  add_trace(x = ~Ano, y = ~Intervalo_superior, name = "Intervalo_superior", type = "scatter", mode = "lines", line = list(dash = "dash"), showlegend = FALSE) %>%
  layout(
    title = "",            # Remover o título
    xaxis = list(title = ""),  # Remover título do eixo X
    yaxis = list(title = ""), # Remover título do eixo Y
    autosize = TRUE 
  )

        
        
}else{
  
  bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}
  
  meta <- bcb.sgs(13521, '1900-01-01')
  
  meta <- arrange(meta, desc(ref.date))
  
  hchart(meta, "line", hcaes(x = ref.date, y = value)) %>%
  hc_title(text = " ") %>%
  hc_subtitle(text = "Fonte: Banco Central") %>%
  hc_legend(enabled = F)
  
}



```

</div>
</div>

<div class="spacer"></div>

#### IPCA {.tabset .tabset-fade .tabset-pills}
<div class="spacer"></div>

O IPCA mede a variação de preços de uma cesta de produtos e serviços consumida pela população. O resultado mostra se os preços aumentaram ou diminuíram de um mês para o outro.

A cesta é definida pela [Pesquisa de Orçamentos Familiares](https://www.ibge.gov.br/estatisticas/sociais/populacao/24786-pesquisa-de-orcamentos-familiares-2.html?utm_source=landing&utm_medium=explica&utm_campaign=inflacao) - POF, do IBGE, que, entre outras questões, verifica o que a população consome e quanto do rendimento familiar é gasto em cada produto: arroz, feijão, passagem de ônibus, material escolar, médico, cinema, entre outros.

O índice, portanto, leva em conta não apenas a variação de preço de cada item, mas também o peso que ele tem no orçamento das famílias.

Atualmente, a população-objetivo do IPCA abrange as famílias<span style="font-weight: bold; color: #ff6600;"> com rendimentos de 1 a 40 salários mínimos</span>, qualquer que seja a fonte, residentes nas áreas urbanas das regiões de abrangência do SNIPC, as quais são: regiões metropolitanas de Belém, Fortaleza, Recife, Salvador, Belo Horizonte, Vitória, Rio de Janeiro, São Paulo, Curitiba, Porto Alegre, além do Distrito Federal e dos municípios de Goiânia, Campo Grande, Rio Branco, São Luís e Aracaju.

##### Índice {.tabset .tabset-fade .tabset-pills}

[Tabela 1337](https://sidra.ibge.gov.br/tabela/1737)

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100vw'}

sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

IPCA <- sidra('/t/1737/n1/all/v/63,2263,2264,2265/p/all/d/v63%202,v2263%202,v2264%202,v2265%202', format(Sys.Date() - months(120), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, desc(Data))
colnames(IPCA) <- c("Data", "Mensal", "3 meses", "6 meses", "12 meses")

datatable(IPCA, options = list(
  pageLength = 10,
  autoWidth = TRUE,
  columnDefs = list(list(className = 'dt-center', targets = '_all'))
), caption = "VARIAÇÃO MENSAL E ACUMULADA", width = "100%", class = "display nowrap")


```

###### Mensal

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y) {
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
}

# Obtendo dados
IPCA <- sidra('/t/1737/n1/all/v/63,2263,2264,2265/p/all/d/v63%202,v2263%202,v2264%202,v2265%202', format(Sys.Date() - months(24), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, Data)
colnames(IPCA) <- c("Data", "Mensal", "3 meses", "6 meses", "12 meses")

# Criando o gráfico com highcharter
hchart(IPCA, "column", hcaes(x = Data, y = Mensal, color = ifelse(Mensal > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")

```

###### 3 meses

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}
# Função sidra
sidra <- function(z, y) {
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
}

# Criar dados iniciais
IPCA <- sidra('/t/1737/n1/all/v/63,2263,2264,2265/p/all/d/v63%202,v2263%202,v2264%202,v2265%202', format(Sys.Date() - months(24), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, desc(Data))
colnames(IPCA) <- c("Data", "Mensal", "3 meses", "6 meses", "12 meses")

hchart(IPCA, "column", hcaes(x = Data, y = `3 meses`, color = ifelse(`3 meses` > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")
```

###### 6 meses

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}
sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

IPCA <- sidra('/t/1737/n1/all/v/63,2263,2264,2265/p/all/d/v63%202,v2263%202,v2264%202,v2265%202', format(Sys.Date() - months(60), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, Data)
colnames(IPCA) <- c("Data", "Mensal", "3 meses", "6 meses", "12 meses")

IPCA_semestral <- IPCA %>% select(Data, `6 meses`) %>% 
  mutate(cor = ifelse(`6 meses`>0, "azul", "vermelho"))

IPCA_semestral$Data <- as.Date(paste0(IPCA_semestral$Data, "-01"), format = "%Y-%m-%d")

hchart(IPCA, "column", hcaes(x = Data, y = `6 meses`, color = ifelse(`6 meses` > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")
```

###### 12 meses 

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}
sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

IPCA <- sidra('/t/1737/n1/all/v/63,2263,2264,2265/p/all/d/v63%202,v2263%202,v2264%202,v2265%202', format(Sys.Date() - months(120), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, Data)
colnames(IPCA) <- c("Data", "Mensal", "3 meses", "6 meses", "12 meses")

IPCA_anual <- IPCA %>% select(Data, `12 meses`) %>% 
  mutate(cor = ifelse(`12 meses`>0, "azul", "vermelho"))

IPCA_anual$Data <- as.Date(paste0(IPCA_anual$Data, "-01"), format = "%Y-%m-%d")

hchart(IPCA, "column", hcaes(x = Data, y = `12 meses`, color = ifelse(`12 meses` > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")
```

##### Grupos {.tabset .tabset-fade .tabset-pills}

- Os gráficos apresentados são referentes aos grupos da cesta que é definida pela Pesquisa de Orçamentos Familiares. 
- Com estes dados é possível identificar quais grupos sofreram maiores mudanças nos níveis de preços no período analisado.

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

grupos_box <- get_sidra(api = '/t/7060/n1/all/v/63/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v63%202')


ggplot(grupos_box, aes(x = Valor, y = fct_rev(`Geral, grupo, subgrupo, item e subitem`), fill = `Geral, grupo, subgrupo, item e subitem`)) +
  geom_boxplot() +
  scale_fill_hue(direction = 1)  +
  labs(
    x = element_text("Valor", face = "bold"),
    y = element_text("Geral, grupo, subgrupo, item e subitem", face = "bold"),
    fill = "Cores"
  )  +
  ggtitle("BOXPLOT - VARIAÇÃO MENSAL DESDE JAN-2020") +
  theme_light()+
  theme(legend.position = "none")
  

```

###### Mensal

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

grupos_mensal <- get_sidra(api = '/t/7060/n1/all/v/63/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v63%202') %>%   
  mutate(
    cor = ifelse(Valor > 0, "#82C35F", "#E75A5A"),
    Mês = as.Date(paste0(Mês, "01"), format = "%Y%m%d")
  ) %>% 
  filter(`Mês (Código)` == max(`Mês (Código)`))

plot_ly(data = grupos_mensal, 
        x = ~Valor, 
        y = ~fct_rev(`Geral, grupo, subgrupo, item e subitem`), 
        type = "bar", 
        marker = list(color = ~cor)) %>% 
  layout(
    xaxis = list(title = "Valor"),
    yaxis = list(title = "Geral, grupo, subgrupo, item e subitem"),
    title = "VARIAÇÃO MENSAL",
    showlegend = FALSE
  )

```

###### Acumulada em 12 meses

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

grupos_mensal <- get_sidra(api = '/t/7060/n1/all/v/2265/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v2265%202') %>%   mutate(
    cor = ifelse(Valor > 0, "#82C35F", "#E75A5A"),
    Mês = as.Date(paste0(Mês, "01"), format = "%Y%m%d"),
    )  %>% 
  filter(`Mês (Código)` == max(`Mês (Código)`))

plot_ly(data = grupos_mensal, 
        x = ~Valor, 
        y = ~fct_rev(`Geral, grupo, subgrupo, item e subitem`), 
        type = "bar", 
        marker = list(color = ~cor)) %>% 
  layout(
    xaxis = list(title = "Valor"),
    yaxis = list(title = "Geral, grupo, subgrupo, item e subitem"),
    title = "VARIAÇÃO ACUMULADA EM 12 MESES",
    showlegend = FALSE
  )

```

###### Pesos dos grupos

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

pesos <- get_sidra(api = '/t/7060/n1/all/v/66/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v66%204') %>%   
  mutate(
    `Mês (Código)` = ymd(paste0(`Mês (Código)`, "01"))
  ) %>% 
  filter(`Mês (Código)` >= max(`Mês (Código)`) - months(6) + 1)

# Usando plot_ly para criar um gráfico de barras
plot_ly(pesos, x = ~`Mês (Código)`, y = ~Valor, type = "bar", color = ~fct_rev(`Geral, grupo, subgrupo, item e subitem`), colors = "Dark2") %>%
  layout(
    xaxis = list(title = " ", titlefont = list(size = 14, color = "black")),
    yaxis = list(title = "Pesos dos grupos", titlefont = list(size = 14, color = "black")),
    barmode = "stack",
    title = "Pesos ou participações dos grupos na cesta",
    showlegend = TRUE
  )


```

##### Localidade

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

local <- get_sidra(api = "/t/7060/n7/all/n6/all/v/2265/p/all/c315/7169/d/v2265%202") %>% 
  filter(`Mês (Código)` == max(`Mês (Código)`)) %>% 
  mutate(cor = ifelse(Valor > 0, "#82C35F", "#E75A5A"))

plot_ly(data = local, 
        x = ~Valor, 
        y = ~fct_rev(`Região Metropolitana e Município`), 
        type = "bar",
        marker = list(color = ~cor)) %>% 
  layout(
    xaxis = list(title = " "),
    yaxis = list(title = " "),
    title = "VARIAÇÃO ACUMULADA 12 MESES DO IPCA POR LOCALIDADE",
    showlegend = FALSE
  )


```


#### INPC {.tabset .tabset-fade .tabset-pills}
<div class="spacer"></div>

O INPC verifica a variação do custo de vida médio apenas de famílias<span style="font-weight: bold; color: #ff6600;"> com renda mensal de 1 a 5 salários mínimos</span>. Esses grupos são mais sensíveis às variações de preços, pois tendem a gastar todo o seu rendimento em itens básicos, como alimentação, medicamentos, transporte etc

O propósito do INPC e IPCA são o mesmo: medir a variação de preços de uma cesta de produtos e serviços consumida pela população. O resultado mostra se os preços aumentaram ou diminuíram de um mês para o outro.

A cesta de ambos é definida pela [Pesquisa de Orçamentos Familiares](https://www.ibge.gov.br/estatisticas/sociais/populacao/24786-pesquisa-de-orcamentos-familiares-2.html?utm_source=landing&utm_medium=explica&utm_campaign=inflacao) - POF, do IBGE, que, entre outras questões, verifica o que a população consome e quanto do rendimento familiar é gasto em cada produto: arroz, feijão, passagem de ônibus, material escolar, médico, cinema, entre outros.

Os índices, portanto, levam em conta não apenas a variação de preço de cada item, mas também o peso que ele tem no orçamento das famílias.
<div class="spacer"></div>

[Tabela 7063](https://sidra.ibge.gov.br/tabela/7063)

##### Índice {.tabset .tabset-fade .tabset-pills}

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

IPCA <- sidra('/t/7063/n1/all/v/44/p/all/c315/7169/d/v44%202', format(Sys.Date() - months(120), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, desc(Data))
colnames(IPCA) <- c("Data", "Mensal", "3 meses", "6 meses", "12 meses")

datatable(IPCA, options = list(pageLength = 10, autoWidth = TRUE, columnDefs = list(list(className = 'dt-center', targets = '_all'))), caption = "VARIAÇÃO MENSAL E ACUMULADA")


```

###### Mensal

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y) {
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
}

# Obtendo dados
IPCA <- sidra('/t/7063/n1/all/v/44/p/all/c315/7169/d/v44%202', format(Sys.Date() - months(24), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, Data)
colnames(IPCA) <- c("Data", "Mensal", "3 meses", "6 meses", "12 meses")

# Criando o gráfico com highcharter
hchart(IPCA, "column", hcaes(x = Data, y = Mensal, color = ifelse(Mensal > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")

```

###### 12 meses 

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}
sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

IPCA <- sidra('/t/7063/n1/all/v/2292/p/all/c315/7169/d/v2292%202', "2020-12") %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, Data)
colnames(IPCA) <- c("Data", "12 meses")

IPCA_anual <- IPCA %>% select(Data, `12 meses`) %>% 
  mutate(cor = ifelse(`12 meses`>0, "azul", "vermelho"))

IPCA_anual$Data <- as.Date(paste0(IPCA_anual$Data, "-01"), format = "%Y-%m-%d")

hchart(IPCA, "column", hcaes(x = Data, y = `12 meses`, color = ifelse(`12 meses` > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")
```

##### Grupos {.tabset .tabset-fade .tabset-pills}

- Os gráficos apresentados são referentes aos grupos da cesta que é definida pela Pesquisa de Orçamentos Familiares. 
- Com estes dados é possível identificar quais grupos sofreram maiores mudanças nos níveis de preços no período analisado.

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

grupos_box <- get_sidra(api = '/t/7063/n1/all/v/44/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v44%202')


ggplot(grupos_box, aes(x = Valor, y = fct_rev(`Geral, grupo, subgrupo, item e subitem`), fill = `Geral, grupo, subgrupo, item e subitem`)) +
  geom_boxplot() +
  scale_fill_hue(direction = 1)  +
  labs(
    x = element_text("Valor", face = "bold"),
    y = element_text("Geral, grupo, subgrupo, item e subitem", face = "bold"),
    fill = "Cores"
  )  +
  ggtitle("BOXPLOT - VARIAÇÃO MENSAL DESDE JAN-2020") +
  theme_light()+
  theme(legend.position = "none")
  

```

###### Mensal

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

grupos_mensal <- get_sidra(api = '/t/7063/n1/all/v/44/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v44%202') %>%   
  mutate(
    cor = ifelse(Valor > 0, "#82C35F", "#E75A5A"),
    Mês = as.Date(paste0(Mês, "01"), format = "%Y%m%d")
  ) %>% 
  filter(`Mês (Código)` == max(`Mês (Código)`))

plot_ly(data = grupos_mensal, 
        x = ~Valor, 
        y = ~fct_rev(`Geral, grupo, subgrupo, item e subitem`), 
        type = "bar", 
        marker = list(color = ~cor)) %>% 
  layout(
    xaxis = list(title = "Valor"),
    yaxis = list(title = "Geral, grupo, subgrupo, item e subitem"),
    title = "VARIAÇÃO MENSAL",
    showlegend = FALSE
  )

```

###### Acumulada em 12 meses

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

grupos_mensal <- get_sidra(api = '/t/7063/n1/all/v/2292/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v2292%202') %>%   mutate(
    cor = ifelse(Valor > 0, "#82C35F", "#E75A5A"),
    Mês = as.Date(paste0(Mês, "01"), format = "%Y%m%d"),
    )  %>% 
  filter(`Mês (Código)` == max(`Mês (Código)`))

plot_ly(data = grupos_mensal, 
        x = ~Valor, 
        y = ~fct_rev(`Geral, grupo, subgrupo, item e subitem`), 
        type = "bar", 
        marker = list(color = ~cor)) %>% 
  layout(
    xaxis = list(title = "Valor"),
    yaxis = list(title = "Geral, grupo, subgrupo, item e subitem"),
    title = "VARIAÇÃO ACUMULADA EM 12 MESES",
    showlegend = FALSE
  )

```

###### Pesos dos grupos

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

pesos <- get_sidra(api = '/t/7063/n1/all/v/45/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v45%204') %>%   
  mutate(
    `Mês (Código)` = ymd(paste0(`Mês (Código)`, "01"))
  ) %>% 
  filter(`Mês (Código)` >= max(`Mês (Código)`) - months(6) + 1)

# Usando plot_ly para criar um gráfico de barras
plot_ly(pesos, x = ~`Mês (Código)`, y = ~Valor, type = "bar", color = ~fct_rev(`Geral, grupo, subgrupo, item e subitem`), colors = "Dark2") %>%
  layout(
    xaxis = list(title = " ", titlefont = list(size = 14, color = "black")),
    yaxis = list(title = "Pesos dos grupos", titlefont = list(size = 14, color = "black")),
    barmode = "stack",
    title = "Pesos ou participações dos grupos na cesta",
    showlegend = TRUE
  )


```

##### Localidade

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

local <- get_sidra(api = "/t/7063/n7/all/n6/all/v/2292/p/all/c315/7169/d/v2292%202") %>% 
  filter(`Mês (Código)` == max(`Mês (Código)`)) %>% 
  mutate(cor = ifelse(Valor > 0, "#82C35F", "#E75A5A"))

plot_ly(data = local, 
        x = ~Valor, 
        y = ~fct_rev(`Região Metropolitana e Município`), 
        type = "bar",
        marker = list(color = ~cor)) %>% 
  layout(
    xaxis = list(title = " "),
    yaxis = list(title = " "),
    title = "VARIAÇÃO ACUMULADA 12 MESES DO INPC POR LOCALIDADE",
    showlegend = FALSE
  )


```

#### IPGM {.tabset .tabset-fade .tabset-pills}
<div class="spacer"></div>

O indicador foi concebido no final dos anos de 1940 para ser uma medida abrangente do movimento de preços, que englobasse não apenas diferentes atividades como também etapas distintas do processo produtivo. Dessa forma, o IGP é um indicador mensal do nível de atividade econômica do país, englobando seus principais setores.

O cálculo do indicador, assim como os outros dois indicadores (IGP-10 e IGP-DI), tem em conta a variação de preços de bens e serviços, bem como de matérias-primas utilizadas na produção agrícola, industrial e construção civil. Dessa forma, o resultado do IGP-M é a <span style="font-weight: bold; color: #ff6600;">média aritmética ponderada da inflação ao produtor (IPA), consumidor (IPC) e construção civil (INCC)</span>.

- Índice de Preços ao Produtor Amplo (IPA);
- Índice de Preços ao Consumidor (IPC);
- Índice Nacional de Custo da Construção (INCC).

Os pesos de cada um dos índices componentes correspondem a parcelas da despesa interna bruta, calculadas com base nas Contas Nacionais – resultando na seguinte distribuição:

- 60% para o IPA;
- 30% para o IPC;
- 10% para o INCC.

Nesse contexto, o IPA é o indicador que monitora a variação de preços percebidos por produtores, ao passo que o IPC acompanha o comportamento dos preços que impactam diretamente o consumidor final. Por fim, o INCC apresenta os custos para a construção civil, em uma análise que leva em conta a variação de preços de materiais de construção e custo de mão de obra especializada.
<div class="spacer"></div>

```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))


## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

## Tabelas do BCB SGS
I <-  c(7450,7456,7453,189)

for (i in I) {
  x <- bcb.sgs(i, '1900-01-01') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "IPA-M", 
    "INCC-M",
    "IPC-M",
    "IGP-M")

df.bcb_longer <- df.bcb %>%
  pivot_longer(cols = -data, names_to = "variavel", values_to = "valor")

## Plotando gráficos
hchart(df.bcb_longer, "line", hcaes(x = data, y = valor, group = variavel)) %>%
  hc_title(text = " ") %>%
  hc_subtitle(text = "Fonte: FGV") %>%
  hc_xAxis(title = list(text = "Meses",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_yAxis(title = list(text = "Percentual",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_legend(enabled = TRUE)


```
<div class="spacer"></div>

##### Mensal

```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))


## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

## Tabelas do BCB SGS
I <-  c(7450,7456,7453,189)

for (i in I) {
  x <- bcb.sgs(i, '1900-01-01') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "IPA-M", 
    "INCC-M",
    "IPC-M",
    "IGP-M")

df.bcb <- arrange(df.bcb, desc(data))
colunas_para_formatar <- colnames(df.bcb)[2:5]

datatable(df.bcb, options = list(
  pageLength = 10,
  autoWidth = TRUE,
  columnDefs = list(list(className = 'dt-center', targets = '_all'))
), caption = "Variação percentual anual", width = "100%", class = "display nowrap") %>% 
  formatRound(
    columns = colunas_para_formatar,
    digits = 2
  )


```

##### Acumulado 12 meses

```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))


## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

## Tabelas do BCB SGS
I <-  c(7450,7456,7453,189)

for (i in I) {
  x <- bcb.sgs(i, '1900-01-01') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "IPA-M", 
    "INCC-M",
    "IPC-M",
    "IGP-M")

# Crie um segundo dataframe para armazenar as variações anuais
df.bcb_MENSAL <- cbind(df.bcb[, 1],((df.bcb[, 2:5] /100) + 1))

# Criar um dataframe vazio para df.bcb_anual
df.bcb_anual <- df.bcb_MENSAL

# Loop para calcular a variação anual para cada coluna
for (i in 2:5) {
  col_nome <- paste0(colnames(df.bcb_MENSAL)[i], "_anual")

  # Inicializar a coluna com NA se ainda não existir
  if (!(col_nome %in% colnames(df.bcb_anual))) {
    df.bcb_anual[[col_nome]] <- NA
  }

  for (j in 12:nrow(df.bcb_MENSAL)) {
    df.bcb_anual[[col_nome]][j] <- (prod(df.bcb_MENSAL[[i]][j:(j-11)]) - 1) * 100
  }
}

df.bcb_anual <- df.bcb_anual[12:nrow(df.bcb_anual),c(1,6:9)]

colnames(df.bcb_anual) <- c("data",
    "IPA-M", 
    "INCC-M",
    "IPC-M",
    "IGP-M")

df.bcb_anual <- df.bcb_anual %>% 
  select(data, `IGP-M`, `IPA-M`,`IPC-M`,`INCC-M`)

df.bcb_anual <- arrange(df.bcb_anual, desc(data)) %>% 
  mutate(data = format(data, "%b-%Y"))

colunas_para_formatar <- colnames(df.bcb_anual)[2:5]

datatable(df.bcb_anual, options = list(
  pageLength = 10,
  autoWidth = TRUE,
  columnDefs = list(list(className = 'dt-center', targets = '_all'))
), caption = "Variação percentual anual", width = "100%", class = "display nowrap") %>% 
  formatRound(
    columns = colunas_para_formatar,
    digits = 2
  )


```

<div class="spacer"></div>

### Juros {.toc .tabset .tabset-fade .tabset-pills}
<div class="spacer"></div>

O juro nada mais é do que o valor do dinheiro no tempo. Cada país possui diferenças quanto ao tipo de juros, devendo sempre se atentar ao contrato. No caso brasileiro, usamos juros compostos com base de 252 dias úteis. Na maioria dos demais países, usa-se juros simples na base 360. 

#### SELIC | CDI

```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))


## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

## Tabelas do BCB SGS
I <-  c(4389)

for (i in I) {
  x <- bcb.sgs(i, '2003-01-01') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "CDI")

df.bcb_longer <- df.bcb %>%
  pivot_longer(cols = -data, names_to = "variavel", values_to = "valor")

## Plotando gráficos
hchart(df.bcb_longer, "line", hcaes(x = data, y = valor, group = variavel)) %>%
  hc_title(text = "") %>%
  hc_subtitle(text = "Fonte: Cetip S.A. – Balcão Organizado de Ativos e Derivativos") %>%
  hc_xAxis(title = list(text = "Data",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_yAxis(title = list(text = "Percentual %a.a.",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_legend(enabled = TRUE)


```


```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))


## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

## Tabelas do BCB SGS
I <-  c(4390, 4390, 433)

for (i in I) {
  x <- bcb.sgs(i, '2003-01-01') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "CDI",
    "SELIC",
    "IPCA")

df.bcb_longer <- df.bcb %>%
  pivot_longer(cols = -data, names_to = "variavel", values_to = "valor")

## Plotando gráficos
hchart(df.bcb_longer, "line", hcaes(x = data, y = valor, group = variavel)) %>%
  hc_title(text = "IPCA | CDI | SELIC - % a.m.") %>%
  hc_subtitle(text = "Fontes: IBGE | Cetip S.A. | BCB-Demab ") %>%
  hc_xAxis(title = list(text = "Data",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_yAxis(title = list(text = "Percentual %a.m.",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_legend(enabled = TRUE)


```

#### TR | TBF

```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))


## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

## Tabelas do BCB SGS
I <-  c(253, 226)

for (i in I) {
  x <- bcb.sgs(i, '2003-01-01') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "Taxa básica financeira (TBF)",
    "Taxa referencial (TR)"
    )

df.bcb_longer <- df.bcb %>%
  pivot_longer(cols = -data, names_to = "variavel", values_to = "valor")

## Plotando gráficos
hchart(df.bcb_longer, "line", hcaes(x = data, y = valor, group = variavel)) %>%
  hc_title(text = " ") %>%
  hc_subtitle(text = "Fonte: BCB-Demab ") %>%
  hc_xAxis(title = list(text = "Data",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_yAxis(title = list(text = "Percentual % a.m.",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_legend(enabled = TRUE)


```

#### TJLP

```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))


## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

## Tabelas do BCB SGS
I <-  c(256)

for (i in I) {
  x <- bcb.sgs(i, '2003-01-01') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "Taxa de juros de longo prazo - TJLP"
    )

df.bcb_longer <- df.bcb %>%
  pivot_longer(cols = -data, names_to = "variavel", values_to = "valor")

## Plotando gráficos
hchart(df.bcb_longer, "line", hcaes(x = data, y = valor, group = variavel)) %>%
  hc_title(text = " ") %>%
  hc_subtitle(text = "Fonte: BCB-Demab ") %>%
  hc_xAxis(title = list(text = "Anos ",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_yAxis(title = list(text = "Percentual % a.a.",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_legend(enabled = TRUE)


```

#### PTAX {.tabset .tabset-fade .tabset-pills}

##### Dólar Americano

```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}
## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))


## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

## Tabelas do BCB SGS
I <-  c(1, 10813)

for (i in I) {
  x <- bcb.sgs(i, '2003-01-01') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "Taxa de câmbio - Livre - Dólar americano (venda) - diário",
    "Taxa de câmbio - Livre - Dólar americano (compra) - diário"
    )

df.bcb_longer <- df.bcb %>%
  pivot_longer(cols = -data, names_to = "variavel", values_to = "valor")

df.bcb_longer <- df.bcb_longer %>% 
  mutate(data = as.Date(data))

plot_ly(df.bcb_longer, x = ~data) %>%
  add_lines(y = ~valor, color = ~variavel, line = list(width = 2)) %>%
  layout(
    title = "",
    xaxis = list(title = "Dia", tickfont = list(size = 14, color = "black")),
    yaxis = list(title = "u.m.c./US$", tickfont = list(size = 14, color = "black")),
    legend = list(x = 0.0, y = -0.2, orientation = "h", font = list(size = 14)),
    font = list(size = 14)
  )


```

##### Euro

```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))


## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

## Tabelas do BCB SGS
I <-  c(21619, 21620)

for (i in I) {
  x <- bcb.sgs(i, '2003-01-01') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "Taxa de câmbio - Livre - Euro (venda)",
    "	Taxa de câmbio - Livre - Euro (compra)"
    )

df.bcb_longer <- df.bcb %>%
  pivot_longer(cols = -data, names_to = "variavel", values_to = "valor")

df.bcb_longer <- df.bcb_longer %>% 
  mutate(data = as.Date(data))

plot_ly(df.bcb_longer, x = ~data) %>%
  add_lines(y = ~valor, color = ~variavel, line = list(width = 2)) %>%
  layout(
    title = "",
    xaxis = list(title = "Dia", tickfont = list(size = 14, color = "black")),
    yaxis = list(title = "R$/u.m.c.", tickfont = list(size = 14, color = "black")),
    legend = list(x = 0.0, y = -0.2, orientation = "h", font = list(size = 14)),
    font = list(size = 14)
  )


```


### Estoque {.toc} 
<div class="spacer"></div>

Os meios de pagamentos amplos são indicadores antecedentes da demanda por moeda, constituindo-se em medida mais fidedigna da liquidez macroeconômica em relação aos agregados monetários restritos, que somente incluem o papel moeda em poder do público e os depósitos à vista. Nesse sentido, os seus componentes podem ser assim definidos:

- M1 é composto pelo Papel-moeda em poder do público e pelos Depósitos à vista;
- M2 adiciona ao M1 os Depósito de poupança, e os Títulos privados emitidos pelas instituições depositárias (1);  
- M3 inclui no M2 as quotas de fundos de investimento depositários e as Operações compromissadas com títulos públicos e privados;
- M4 engloba ao M3 os títulos públicos emitidos pelo Governo Federal.

Deve-se ressaltar que os fundos de investimento considerados no cálculo do M3 não correspondem à população, compreendendo, efetivamente, as modalidades: Cambial; Renda fixa; e Multimercado. Na medida que não são considerados emissores de liquidez, e, portanto, classificados como agentes não depositários, estão excluídos os fundos de ações, fundos de dívida externa e os fundos de investimentos em quotas de fundos de investimentos.

Observe-se que, dentre os títulos federais, somente são considerados os registrados no Sistema Especial de Liquidação e Custódia (Selic). Apesar da alta liquidez dos instrumentos de captação do Tesouro Nacional, entendeu-se que o reconhecimento dessas emissões como quase-moeda nos conceitos de meios de pagamento deve ser o mais restrito possível, dado que aquele Órgão não integra o Sistema Financeiro Nacional (SFN).

*(1) São consideradas instituições depositárias aquelas cujos instrumentos de captação integram os meios de pagamento ampliados.*

```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))


## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

## Tabelas do BCB SGS
I <-  c(27791, 27810, 27813, 27815)

for (i in I) {
  x <- bcb.sgs(i, '2003-12-03') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "M1",
    "M2",
    "M3",
    "M4"
    )

df.bcb_longer <- df.bcb %>%
  pivot_longer(cols = -data, names_to = "variavel", values_to = "valor")

df.bcb_longer <- df.bcb_longer %>% 
  mutate(data = as.Date(data))

plot_ly(df.bcb_longer, x = ~data) %>%
  add_lines(y = ~valor, color = ~variavel, line = list(width = 2)) %>%
  layout(
    title = "Fonte: BCB - DSTAT",
    xaxis = list(title = "Mensal", tickfont = list(size = 14, color = "black")),
    yaxis = list(title = "u.m.c. (mil).", tickfont = list(size = 14, color = "black")),
    legend = list(x = 0.0, y = -0.2, orientation = "h", font = list(size = 14)),
    font = list(size = 14)
  )


```


### B. pagamentos {.toc} 
<div class="spacer"></div>

O balanço de pagamentos é o registro estatístico de todas as transações – fluxo de bens e direitos de valor econômico – entre os residentes de uma economia e o restante do mundo, ocorridos em determinado período de tempo.

[Séries históricas – BPM6](https://www.bcb.gov.br/estatisticas/notasmetodologicas)

```{r include=FALSE}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))


## funcao para obter dados do bacen sgs
bcb.sgs <- function(id, start_date, max_attempts = 10) {
  attempt <- 1
  result <- NULL
  
  while (is.null(result) && attempt <= max_attempts) {
    tryCatch({
      result <- gbcbd_get_series(id = id,
                                  first.date = '1998-01-01',
                                  last.date = Sys.Date(),
                                  format.data = 'long',
                                  use.memoise = TRUE, 
                                  cache.path = tempdir(), 
                                  do.parallel = FALSE)
    }, error = function(e) {
      cat(paste("Error in fetching data for id =", id, "Attempt", attempt, "\n"))
      Sys.sleep(2)  # Aguarde um pouco antes de tentar novamente
      attempt <- attempt + 1
    })
    
    # Reiniciar attempt para 1 se a tentativa for bem-sucedida
    if (!is.null(result)) {
      attempt <- 1
    }
  }
  
  if (is.null(result)) {
    cat(paste("Max attempts reached for id =", id, ". Unable to fetch data.\n"))
  }
  
  return(result)
}

processar_dados <- function(codigos, grupo, subgrupo, rubricas) {
  df <- data.frame()

  for (i in codigos) {
    x <- bcb.sgs(i) %>% 
      select(ref.date, value)
    colnames(x)[2] <- as.character(i)

    if (nrow(df) == 0) {
      df <- x
    } else {
      df <- merge(df, x, by = "ref.date")
    }
  }

  colnames(df) <- rubricas
  
  df <- arrange(df, desc(data))

  df_transposto <- t(df)
  df_transposto <- as.data.frame(df_transposto)
  
  # Adicionar as colunas de grupo e subgrupo
  df_transposto$grupo <- grupo
  df_transposto$subgrupo <- subgrupo
  
  df_transposto <- df_transposto %>%
    select(grupo, subgrupo, everything())
  
  # Ajustar nomes das colunas após a transposição
  colnames(df_transposto) <- c("grupo", "subgrupo", as.character(df_transposto[1, -c(1, 2)]))

  # Remover a primeira linha que agora é usada como colunas
  df_transposto <- df_transposto[-1, ]

  
  return(df_transposto)
}


# Transacoes_Correntes (grupo)
rubricas <- c("data",
              "1. Transações Correntes")

Transacoes_Correntes <- processar_dados(c(22701), 
                                  "Transações Correntes",
                                  "Transações Correntes", 
                                  rubricas)

Sys.sleep(1)

## BALANCA_COMERCIAL_DE_BENS
rubricas <- c("data",
              "1.1 Balança comercial de bens",
              "1.1.1 Exportações",
              "1.1.2 Importações")

df_transposto_BALANCA_COMERCIAL_DE_BENS <- processar_dados(c(22707,
                                                          22708, 
                                                          22709), 
                                                          "Transações Correntes",
                                                          "Balança Comercial de Bens", 
                                                          rubricas)

Sys.sleep(1)

## BALANCA_COMERCIAL_DE_SERVICOS
rubricas <- c("data",
              "1.2 Balança comercial de serviços",
              "1.2.1 Serviços de manufatura sobre insumos físicos pertencentes a outros",
              "1.2.2 Serviços de manutenção e reparo",
              "1.2.3 Transportes",
              "1.2.4 Viagens",
              "1.2.5 Construção",
              "1.2.6 Seguros",
              "1.2.7 Serviços financeiros",
              "1.2.8 Serviços de propriedade intelectual",
              "1.2.9 Telecomunicação, computação e informações",
              "1.2.10 Aluguel de equipamentos",
              "1.2.11 Outros serviços de negócio",
              "1.2.12 Serviços culturais, pessoais e recreativos",
              "1.2.13 Serviços governamentais")

df_transposto_BALANCA_COMERCIAL_DE_SERVICOS <- processar_dados(c(22719,
                                                              22722, 
                                                              22725,
                                                              22728,
                                                              22740,
                                                              22761,
                                                              22764,
                                                              22767,
                                                              22776,
                                                              22779,
                                                              22782,
                                                              22785,
                                                              22788,
                                                              22797), 
                                                              "Transações Correntes",
                                                              "Balança Comercial de Serviços", 
                                                              rubricas)


Sys.sleep(1)

## RENDA_PRIMARIA
rubricas <- c("data",
              "1.3 Renda Primária",
              "1.3.1 Salários e ordenados",
              "1.3.2 Renda de investimento em carteira",
              "1.3.3 Demais rendas primárias")

df_transposto_RENDA_PRIMARIA <- processar_dados(c(22800,
                                                  22803, 
                                                  22806,
                                                  22835), 
                                                   "Transações Correntes",
                                                   "Renda primária", 
                                                   rubricas)

Sys.sleep(1)

## RENDA_SECUNDARIA
rubricas <- c("data",
               "1.4 Renda Secundária",
               "1.4.1 Governo",
               "1.4.2 Demais setores")

df_transposto_RENDA_SECUNDARIA <- processar_dados(c(22838,
                                                    22841, 
                                                    22844), 
                                                    "Transações Correntes",
                                                    "Renda secundária", 
                                                    rubricas)
Sys.sleep(1)

# CONTA_CAPITAL
rubricas <- c("data",
              "2. Conta Capital",
              "2.1 Ativos não financeiros não produzidos",
              "2.2 Transferências de capital")

df_transposto_CONTA_CAPITAL <- processar_dados(c(22851,
                                                 22854, 
                                                 22860), 
                                                 "Conta Capital",
                                                 "Conta Capital", 
                                                 rubricas)
Sys.sleep(1)
                      
# CONTA_FINANCEIRA
rubricas <- c("data",
              "3. Conta Financeira")

Conta_Financeira <- processar_dados(c(22863), 
                                  "Conta Financeira",
                                  "Conta Financeira", 
                                  rubricas)
Sys.sleep(1)

## INVESTIMENTO_DIRETO
rubricas <- c("data",
              "3.1 Investimento Direto",
              "3.1.1 Investimentos diretos no exterior",
              "3.1.2 Investimentos diretos no país")

df_transposto_INVESTIMENTO_DIRETO <- processar_dados(c(22864,
                                                       22803, 
                                                       22885), 
                                                       "Conta Financeira",
                                                       "Investimento Direto", 
                                                       rubricas)
Sys.sleep(1)

## INVESTIMENTO_EM_CARTEIRA
rubricas <- c("data",
               "3.2 Investimento em Carteira",
               "3.2.1 Ativos",
               "3.2.2 Passivos")

df_transposto_INVESTIMENTO_EM_CARTEIRA <- processar_dados(c(22905,
                                                            22906, 
                                                            22806), 
                                                            "Conta Financeira",
                                                            "Investimento em Carteira", 
                                                            rubricas)
Sys.sleep(1)

## DERIVATIVOS
rubricas <- c("data",
              "3.3 Derivativos")

df_transposto_DERIVATIVOS <- processar_dados(c(22966), 
                                                "Conta Financeira",
                                                "Derivativos", 
                                                rubricas)
Sys.sleep(1)

## OUTROS_INVESTIMENTOS
rubricas <- c("data",
             "3.4 Outros Investimentos",
             "3.4.1 Outras participações em capital",
             "3.4.2 Moeda e depósitos",
             "3.4.3 Empréstimos",
             "3.4.4 Seguros, esquemas de pensão e de fundos de garantia",
             "3.4.5 Créditos comerciais e adiantamentos",
             "3.4.6 Outras contas a pagar/receber",
             "3.4.7 Direitos Especiais de Saque - Incidência líquida de passivos"
              )

df_transposto_OUTROS_INVESTIMENTOS <- processar_dados(c(22969,
                                                        22972, 
                                                        22979,
                                                        22990,
                                                        23021,
                                                        23024,
                                                        23035,
                                                        23042), 
                                                        "Conta Financeira",
                                                        "Outros Investimentos", 
                                                        rubricas)
Sys.sleep(1)

## ATIVOS_DE_RESERVA
rubricas <- c("data",
               "3.5 Ativos de Reserva",
               "3.5.1 Ouro monetário",
               "3.5.2 Direitos Especiais de Saque",
               "3.5.3 Posição de reserva no FMI",
               "3.5.4 Outros ativos de reserva",
               "3.5.5 Demais ativos"
              )

df_transposto_ATIVOS_DE_RESERVA <- processar_dados(c(23043,
                                                     23044, 
                                                     23047,
                                                     23048,
                                                     23049,
                                                     23059), 
                                                     "Conta Financeira",
                                                     "Ativos de Reserva", 
                                                     rubricas)
Sys.sleep(1)

# ERROS_E_OMISSOES
rubricas <- c("data",
              "4. Erros e Omissões")

df_transposto_ERROS_E_OMISSOES <- processar_dados(c(23060), 
                                                  "Erros e Omissões",
                                                   "Erros e Omissões", 
                                                   rubricas)

```


```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100vw'}

DF_BALANCO_DE_PAGAMENTOS <- rbind(Transacoes_Correntes,
                                  df_transposto_BALANCA_COMERCIAL_DE_BENS,
                                  df_transposto_BALANCA_COMERCIAL_DE_SERVICOS,
                                  df_transposto_RENDA_PRIMARIA,
                                  df_transposto_RENDA_SECUNDARIA,
                                  df_transposto_CONTA_CAPITAL,
                                  Conta_Financeira,
                                  df_transposto_INVESTIMENTO_DIRETO,
                                  df_transposto_INVESTIMENTO_EM_CARTEIRA,
                                  df_transposto_DERIVATIVOS,
                                  df_transposto_OUTROS_INVESTIMENTOS,
                                  df_transposto_ATIVOS_DE_RESERVA,
                                  df_transposto_ERROS_E_OMISSOES)

df <- DF_BALANCO_DE_PAGAMENTOS[, -(1:2)]

tabela_rownames<- c("1. Transações Correntes",
                    "1.1 Balança comercial de bens",
                    "1.1.1 Exportações",
                    "1.1.2 Importações",
                    "1.2 Balança comercial de serviços",
                    "1.3 Renda Primária",
                    "1.4 Renda Secundária",
                    "2. Conta Capital",
                    "3. Conta Financeira",
                    "3.1 Investimento Direto",
                    "3.2 Investimento em Carteira",
                    "3.3 Derivativos",
                    "3.4 Outros Investimentos",
                    "3.5 Ativos de Reserva",
                    "4. Erros e Omissões")



tabela <- df[rownames(df) %in% tabela_rownames, , drop = FALSE]

tabela <- tabela[, 1:6]
nomes_colunas <- colnames(tabela)
nomes_colunas_formatados <- format(ymd(nomes_colunas), "%b-%Y")
colnames(tabela) <- nomes_colunas_formatados
tabela <- tabela %>% mutate(Rubricas = rownames(tabela)) %>% 
  select(Rubricas, everything())

tabela %>% gt() %>% 
  tab_style(style = "font-size: 1.6rem;", locations = cells_body()) %>% 
  cols_align(align = "left",
             columns = 1) %>% 
  cols_align(align = "center",
             columns = -1)%>% 
  tab_header(
  title = "Balanço de Pagamentos",
  subtitle = "Fonte: BCB - DSTAT") %>% 
  tab_source_note(md("Unidade: *US$ (milhões)*"))%>%
  gt_theme_538()



```


```{r include= FALSE, warning=FALSE}

# Verifique se o arquivo existe
if (file.exists("docs/tabela_completa.xlsx")) {
  # Se existir, exclua o arquivo
  fs::file_delete("docs/tabela_completa.xlsx")
}

file_path <- "docs/tabela_completa.xlsx"
openxlsx::write.xlsx(df, file_path, rowNames = T)

```
<div class="spacer"></div>

[Download tabela completa](docs/tabela_completa.xlsx)

<div class="spacer"></div>

## GOVERNO {.toc}
<div class="spacer"></div>

Dados referentes as receitas e dispêndios do governo.

- [PPA | LDO | LOA](https://www12.senado.leg.br/orcamento/legislacao-orcamentaria#:~:text=A%20LOA%20%C3%A9%20o%20or%C3%A7amento,de%20agosto%20de%20cada%20ano.)
<div class="spacer"></div>

### Defict fiscal {.toc} 



### Emissão de dívidas {.toc} 

## MERCADO NACIONAL {.toc}


```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))

## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

for (i in 1402:1406) {
  x <- bcb.sgs(i, '1900-01-01') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "Brasil - Comercial", 
    "Brasil - Residencial",
    "Brasil - Industrial",
    "Brasil - Outros",
    "Brasil - Total")

df.bcb <- df.bcb %>%
  pivot_longer(cols = -data, names_to = "variavel", values_to = "valor")

## Plotando gráficos
hchart(df.bcb, "line", hcaes(x = data, y = valor, group = variavel)) %>%
  hc_title(text = "Consumo de energia elétrica") %>%
  hc_subtitle(text = "Fonte: Eletrobras") %>%
  hc_xAxis(title = list(text = "Meses",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_yAxis(title = list(text = "Gigawatts-hora",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_legend(enabled = TRUE)


```


### CAGED 
<div class="spacer"></div>

O [Cadastro Geral de Empregados e Desempregados (CAGED)](https://www.gov.br/trabalho-e-emprego/pt-br/servicos/empregador/caged) foi criado como registro permanente de admissões e dispensa de empregados, sob o regime da Consolidação das Leis do Trabalho (CLT). É utilizado pelo Programa de Seguro-Desemprego, para conferir os dados referentes aos vínculos trabalhistas, além de outros programas sociais.
<div class="spacer"></div>

```{r include=FALSE}


dados_ipea <- function(grupo){
dados <- data.frame(date = character(), stringsAsFactors = FALSE)

# Loop para baixar e juntar os dados
for (i in seq_along(grupo$parametro1)) {
  codigo <- grupo$parametro1[i]
  nome_codigo <- grupo$parametro2[i]
  
  df <- ipeadata(code = codigo, language = "br") %>% 
    select(date, value) 
    
  colnames(df) <- c("date", paste(nome_codigo)) 
  
  if (nrow(dados) > 0) {
    dados <- merge(dados, df, by = "date", all = TRUE)
  } else {
    dados <- df
  }
}
return(dados)
}

novo <- list(parametro1 = c("CAGED12_SALDON12",
                             "CAGED12_DESLIGN12",
                             "CAGED12_ADMISN12"), 
             parametro2 =  c("saldo",
                             "demissões",
                             "admissões"))

antigo <- list(parametro1 = c("CAGED12_SALDO12",
                              "CAGED12_DESLIG",
                              "CAGED12_ADMIS"), 
              parametro2 =  c("saldo",
                              "demissões",
                              "admissões"))

novo_caged <- dados_ipea(novo) %>% 
  arrange(desc(date))
antigo_caged <- dados_ipea(antigo) %>% 
  arrange(desc(date))
total_caged <- rbind(novo_caged, antigo_caged)

calcular_variacao_mensal <- function(col) {
  if (is.numeric(col)) {
    col_numeric <- as.numeric(col)
    return(((col / lag(col, n = 1)) - 1) * 100)
  } else {
    return(col)
  }
}
calcular_variacao_anual <- function(col) {
  if (is.numeric(col)) {
    col_numeric <- as.numeric(col)
    return(((col / lag(col, n = 1)) - 12) * 100)
  } else {
    return(col)
  }
}

```

```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}


head(novo_caged, n=12) %>% gt() %>% 
  fmt_number(
    columns = where(is.numeric),
    decimals = 0,
    use_seps = TRUE ,
    sep_mark = "."
  ) %>%         
  tab_style(style = "font-size: 1.6rem;", locations = cells_body()) %>% 
  cols_align(align = "left",
             columns = 1) %>% 
  cols_align(align = "center",
             columns = -1)%>% 
  tab_header(
  title = "Variação mensal do Novo Caged",
  subtitle = "Fonte: Min. Economia - SEPRT") %>% 
  tab_source_note(md("Secretaria Especial de Previdência e Trabalho, Cadastro Geral de Empregados e Desempregados (Min. Economia/SEPRT/Novo Caged)"))%>%
  tab_footnote("CAGED12_SALDON12 | CAGED12_DESLIGN12 | CAGED12_ADMISN12") %>% 
  gt_theme_538()

```
<div class="spacer"></div>

```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

# Converter a data para formato de texto
total_caged <- arrange(total_caged, date)

total_caged$date_text <- as.character(total_caged$date)

hchart(total_caged, type = "line", hcaes(x = date_text)) %>%
  hc_add_series(total_caged$saldo, name = "Saldo") %>%
  hc_add_series(total_caged$demissões, name = "Demissões") %>%
  hc_add_series(total_caged$admissões, name = "Admissões") %>%
  hc_title(text = "Antigo e Novo Caged") %>%
  hc_subtitle(text = "Fonte: Ministério da Economia - SEPRT") %>%
  hc_credits(text = "Novo Caged após 2020") %>% 
  hc_xAxis(
    title = list(text = " "),
    plotLines = list(
      list(
        color = "#00BFFF",  # Vermelho
        width = 4,
        value = which(total_caged$date_text == "2020-01-01") - 1,
        dashStyle = "dash"
      )
    )
  ) %>% 
  hc_plotOptions(
    series = list(
      events = list(
        click = JS("function(event) {
          var chart = this;
          var extremes = chart.xAxis[0].getExtremes();
          var range = extremes.max - extremes.min;
          var left = event.xAxis[0].value - (range / 2);
          var right = event.xAxis[0].value + (range / 2);
          chart.xAxis[0].setExtremes(left, right);
        }")
      )
    )
  ) %>% 
  hc_legend(enabled = TRUE)

  

```
<div class="spacer"></div>

### PNAD Contínua{.toc} 
<div class="spacer"></div>

A [Pnad Contínua](https://www.ibge.gov.br/estatisticas/sociais/populacao/9171-pesquisa-nacional-por-amostra-de-domicilios-continua-mensal.html?=&t=o-que-e) isa acompanhar as flutuações trimestrais e a evolução, no curto, médio e longo prazos, da força de trabalho, e outras informações necessárias para o estudo do desenvolvimento socioeconômico do País.
<div class="spacer"></div>
Os indicadores mensais utilizam as informações dos últimos três meses consecutivos da pesquisa, existindo, entre um trimestre móvel e o seguinte, repetição das informações de dois meses. Assim, os indicadores da PNAD Contínua produzidos mensalmente não refletem a situação de cada mês, mas, sim, a situação do trimestre móvel que finaliza a cada mês.
<div class="spacer"></div>

[Tabela 6381](https://sidra.ibge.gov.br/tabela/6381)
```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Trimestre Móvel (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Trimestre Móvel (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

PNAD <- sidra('/t/6381/n1/all/v/4099/p/all/d/v4099%201', 
              format(Sys.Date() - months(240), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

PNAD <- arrange(PNAD, Data)
colnames(PNAD) <- c("Data", "Taxa de desocupação")

hchart(PNAD, type = "line", hcaes(x = Data)) %>%
  hc_add_series(PNAD$`Taxa de desocupação`, name = "Real") %>%
  hc_title(text = "Taxa de desocupação - PNADC/M") %>%
  hc_subtitle(text = "Fonte: IBGE") %>%
  hc_credits(text = "Tabela 6381") %>% 
  hc_plotOptions(
    series = list(
      events = list(
        click = JS("function(event) {
          var chart = this;
          var extremes = chart.xAxis[0].getExtremes();
          var range = extremes.max - extremes.min;
          var left = event.xAxis[0].value - (range / 2);
          var right = event.xAxis[0].value + (range / 2);
          chart.xAxis[0].setExtremes(left, right);
        }")
      )
    )
  ) %>% 
  hc_legend(enabled = TRUE)


```
<div class="spacer"></div>

[Tabela 6397](https://sidra.ibge.gov.br/tabela/6397)
```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

desocupacao <- get_sidra(api = "/t/6397/n1/all/v/4099/p/all/c58/allxt/d/v4099%201")

hchart(desocupacao, type = "line" , hcaes(x = `Trimestre`, y = Valor, group = `Grupo de idade`)) %>%
  hc_title(text = "Taxa de desocupação - por grupo de idade - PNADC/T") %>%
  hc_subtitle(text = "Fonte: IBGE") %>%
  hc_credits(text = "Tabela 6381") %>% 
  hc_legend(enabled = TRUE)


```
<div class="spacer"></div>


[Tabela 6396](https://sidra.ibge.gov.br/tabela/6396)
```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

desocupacao <- get_sidra(api = "/t/6396/n1/all/v/4099/p/all/c2/all/d/v4099%201")

hchart(desocupacao, type = "line" , hcaes(x = `Trimestre`, y = Valor, group = `Sexo`)) %>%
  hc_title(text = "Taxa de desocupação - por sexo - PNADC/T") %>%
  hc_subtitle(text = "Fonte: IBGE") %>%
  hc_credits(text = "Tabela 6396") %>% 
  hc_legend(enabled = TRUE)


```
<div class="spacer"></div>

[Tabela 6390](https://sidra.ibge.gov.br/tabela/6390)
```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Trimestre Móvel (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Trimestre Móvel (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

PNAD <- sidra('/t/6390/n1/all/v/5929,5933/p/all', 
              format(Sys.Date() - months(240), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

PNAD <- arrange(PNAD, Data)
colnames(PNAD) <- c("Data", "Nominal", "Real")

hchart(PNAD, type = "line", hcaes(x = Data)) %>%
  hc_add_series(PNAD$Real, name = "Real") %>%
  hc_add_series(PNAD$Nominal, name = "Nominal") %>%
  hc_title(text = "Rendimento médio mensal - PNADC/M") %>%
  hc_subtitle(text = "Fonte: IBGE") %>%
  hc_credits(text = "Tabela 6390") %>% 
  hc_plotOptions(
    series = list(
      events = list(
        click = JS("function(event) {
          var chart = this;
          var extremes = chart.xAxis[0].getExtremes();
          var range = extremes.max - extremes.min;
          var left = event.xAxis[0].value - (range / 2);
          var right = event.xAxis[0].value + (range / 2);
          chart.xAxis[0].setExtremes(left, right);
        }")
      )
    )
  ) %>% 
  hc_legend(enabled = TRUE)



```
<div class="spacer"></div>

### PMC {.toc .tabset .tabset-fade .tabset-pills}

A *Pesquisa Mensal do Comércio* - PMC é uma pesquisa por amostragem probabilística, realizada em todas as Unidades da Federação.

O objetivo contemplado no desenho da amostra é a obtenção de estimativas dos totais populacionais referentes à variável receita bruta de revenda, por Unidade da Federação e por atividade PMC, utilizadas para construir os indicadores da pesquisa que são divulgados mensalmente. A unidade de investigação da PMC é a empresa, sendo também a unidade amostral, ou seja, a unidade utilizada para a seleção e expansão da amostra.

As séries da PMC ajustadas sazonalmente consideram como fatores sazonais, o efeito calendário, os feriados de Carnaval, Páscoa e Corpus Christi além da identificação de outliers. Os cálculos são feitos utilizando-se o software X12 ARIMA, do U.S. Census Bureau.

#### COMÉRCIO VAREJISTA {.tabset .tabset-fade .tabset-pills}

- Refere-se à venda de bens e serviços diretamente ao consumidor final para uso pessoal ou doméstico.
- Inclui uma ampla gama de atividades, desde a venda de alimentos e vestuário até produtos eletrônicos, móveis e combustíveis, entre outros.
- As atividades do comércio varejista são monitoradas para avaliar a demanda do consumidor e a saúde geral da economia.

[Tabela 8880](https://sidra.ibge.gov.br/tabela/8880)

##### RECEITA

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

# Capturando os dados e tratando
PMC = sidra('/t/8880/n1/all/v/7169/p/all/c11046/56733/d/v7169%205', format(Sys.Date() - months(26), "%Y-%m")) %>% 
  rename(PMC = Valor) %>% 
  mutate(PMC_MENSAL = ((PMC / lag(PMC)-1) * 100 )) %>% 
  mutate(Cor = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A")) %>% 
  filter(Data >= format(Sys.Date() - months(25), "%Y-%m"))

#Plotando
hchart(PMC, "column", hcaes(x = Data, y = PMC_MENSAL, color = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")

```

##### VOLUME

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

#Capoturando e tratando dados
PMC = sidra('/t/8880/n1/all/v/7169/p/all/c11046/56734/d/v7169%205', format(Sys.Date() - months(26), "%Y-%m")) %>% 
  rename(PMC = Valor) %>% 
  mutate(PMC_MENSAL = ((PMC / lag(PMC)-1) * 100 )) %>% 
  mutate(Cor = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A")) %>% 
  filter(Data >= format(Sys.Date() - months(25), "%Y-%m"))

#protando resultado
hchart(PMC, "column", hcaes(x = Data, y = PMC_MENSAL, color = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")

```

#### COMÉRCIO VAREJISTA AMPLIADO {.tabset .tabset-fade .tabset-pills}

- Inclui todas as atividades do comércio varejista, mas vai além ao incorporar categorias adicionais relacionadas ao varejo.
- Normalmente, o comércio varejista ampliado pode incluir a venda de veículos, motocicletas, partes e peças; material de construção; e equipamentos e materiais para escritório, informática e comunicação, entre outros.
- Essa categoria é mais abrangente e oferece uma visão mais ampla do ambiente de varejo, incorporando setores que podem não estar diretamente relacionados ao consumo pessoal diário.

[Tabela 8881](https://sidra.ibge.gov.br/tabela/8881)

##### RECEITA

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

PMC = sidra('/t/8881/n1/all/v/7169/p/all/c11046/56735/d/v7169%205', format(Sys.Date() - months(26), "%Y-%m")) %>% 
  rename(PMC = Valor) %>% 
  mutate(PMC_MENSAL = ((PMC / lag(PMC)-1) * 100 )) %>% 
  mutate(Cor = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A")) %>% 
  filter(Data >= format(Sys.Date() - months(25), "%Y-%m"))

#Plotando
hchart(PMC, "column", hcaes(x = Data, y = PMC_MENSAL, color = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")
```

##### VOLUME

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

PMC = sidra('/t/8881/n1/all/v/7169/p/all/c11046/56736/d/v7169%205', format(Sys.Date() - months(26), "%Y-%m")) %>% 
  rename(PMC = Valor) %>% 
  mutate(PMC_MENSAL = ((PMC / lag(PMC)-1) * 100 )) %>% 
  mutate(Cor = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A")) %>% 
  filter(Data >= format(Sys.Date() - months(25), "%Y-%m"))

#Protando gráfico
hchart(PMC, "column", hcaes(x = Data, y = PMC_MENSAL, color = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")

```

### PMS {.toc .tabset .tabset-fade .tabset-pills}

A *Pesquisa Mensal de Serviços* - PMS tem como objetivo produzir indicadores que permitam acompanhar o comportamento conjuntural dos principais segmentos empresariais não-financeiros do setor de serviços, excluindo-se os da saúde e da educação, complementando, através da análise de curto prazo, o mapeamento da estrutura das atividades de serviços no País, efetuado pela Pesquisa Anual de Serviços - PAS. 

[Tabela 5906](https://sidra.ibge.gov.br/tabela/5906)

#### RECEITA

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}
sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

PMS = sidra('/t/5906/n1/all/v/7167/p/all/c11046/56725/d/v7167%205', format(Sys.Date() - months(26), "%Y-%m")) %>% 
  rename(PMS = Valor) %>% 
  mutate(PMS_MENSAL = ((PMS / lag(PMS)-1) * 100 )) %>% 
  mutate(Cor = ifelse(PMS_MENSAL > 0, "#82C35F", "#E75A5A"))%>% 
  filter(Data >= format(Sys.Date() - months(25), "%Y-%m"))

hchart(PMS, "column", hcaes(x = Data, y = PMS_MENSAL, color = ifelse(PMS_MENSAL > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")

```

#### VOLUME

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}
sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

PMS = sidra('/t/5906/n1/all/v/7167/p/all/c11046/56726/d/v7167%205', format(Sys.Date() - months(26), "%Y-%m")) %>% 
  rename(PMS = Valor) %>% 
  mutate(PMS_MENSAL = ((PMS / lag(PMS)-1) * 100 )) %>% 
  mutate(Cor = ifelse(PMS_MENSAL > 0, "#82C35F", "#E75A5A"))%>% 
  filter(Data >= format(Sys.Date() - months(25), "%Y-%m"))

hchart(PMS, "column", hcaes(x = Data, y = PMS_MENSAL, color = ifelse(PMS_MENSAL > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")

```

### PMI {.toc} 

<div class="spacer"></div>
<div class="dual-frames">
<div class="frame">

<!--Usar biblioteca lightbox do java para criar o popup -->
  <a href="images/PMI/manufactoring_jan.png" data-lightbox="imagem" data-title="Fonte: [S&P Global Brazil Manufacturing PMI](https://www.pmi.spglobal.com/Public/Release/PressReleases?language=pt)">
    <img src="images/PMI/manufactoring_jan.png" alt="Imagem" class="img-responsive center" style="display: inline-block;">
  </a>
  
</div>
<div class="frame">

<!--Usar biblioteca lightbox do java para criar o popup -->
  <a href="images/PMI/services_jan.png" data-lightbox="imagem" data-title="Fonte: [S&P Global Brazil Services PMI](https://www.pmi.spglobal.com/Public/Release/PressReleases?language=pt)">
    <img src="images/PMI/services_jan.png" alt="Imagem" class="img-responsive center" style="display: inline-block;">
  </a>

</div>
</div>

[S&P Global Brasil PMI® setor industrial](https://www.pmi.spglobal.com/Public/Home/PressRelease/51aecc67759445668562c75304340f89)
[PMI® Serviços S&P Global para o Brasil](https://www.pmi.spglobal.com/Public/Home/PressRelease/236326c8841a4b229368ed91b490c17b)

<div class="spacer"></div>

### Fenabrav

<div class="spacer"></div>

Número de unidades de autoveículos que foram emplacados no período de referência. Neste caso, trata-se do número de emplacamentos dos autoveículos, que corresponde a soma dos automóveis, comerciais leves, caminhões e ônibus


```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

dados_ipea <- function(grupo){
dados <- data.frame(date = character(), stringsAsFactors = FALSE)

# Loop para baixar e juntar os dados
for (i in seq_along(grupo$parametro1)) {
  codigo <- grupo$parametro1[i]
  nome_codigo <- grupo$parametro2[i]
  
  df <- ipeadata(code = codigo, language = "br") %>% 
    select(date, value) 
    
  colnames(df) <- c("date", paste(nome_codigo)) 
  
  if (nrow(dados) > 0) {
    dados <- merge(dados, df, by = "date", all = TRUE)
  } else {
    dados <- df
  }
}
return(dados)
}

novo <- list(parametro1 = c("FENABRAVE12_VENDAUTO12",
                             "FENABRAVE12_VENDVETOT12"), 
             parametro2 =  c("Emplacamento de carros de passeio",
                             "Emplecamento de automóveis, comerciais leves, caminhões e ônibus"))


carros <- dados_ipea(novo) %>% 
  mutate(date = format(date, "%Y-%m")) %>% 
  pivot_longer(cols = -date, names_to = "variavel", values_to = "valor")



hchart(carros, type = "line", hcaes(x = date, y = valor, group=variavel)) %>%
  hc_title(text = "Emplacamentos") %>%
  hc_subtitle(text = "Fonte: Fenabrav") %>%
  hc_credits(text = "Ipeadata: FENABRAVE12_VENDAUTO12 | FENABRAVE12_VENDVETOT12") %>% 
  hc_legend(enabled = TRUE)
  




```


<div class="spacer"></div>

### ICC

O Índice de confiança do consumidor (ICC) tem como objetivo identificar o sentimento dos consumidores levando em conta suas condições econômicas atuais e a expectativa em relação à sua situação econômica futura. O índice é calculado a partir de um questionário e, em cada pergunta, são computadas as diferenças entre as frequências de respostas positivas e negativas, sendo o índice final a média simples dessas diferenças. 
<div class="spacer"></div>
Variando de 0 (pessimismo total) a 200 (otimismo total), ele é composto a partir de dados segmentados por nível de renda, sexo e idade. 
O ICC é composto por outros dois índices: 
- ICEA - Índice de condições econômicas atuais
- IEC - Índice de expectativas do consumidor

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

dados_ipea <- function(grupo){
dados <- data.frame(date = character(), stringsAsFactors = FALSE)

# Loop para baixar e juntar os dados
for (i in seq_along(grupo$parametro1)) {
  codigo <- grupo$parametro1[i]
  nome_codigo <- grupo$parametro2[i]
  
  df <- ipeadata(code = codigo, language = "br") %>% 
    select(date, value) 
    
  colnames(df) <- c("date", paste(nome_codigo)) 
  
  if (nrow(dados) > 0) {
    dados <- merge(dados, df, by = "date", all = TRUE)
  } else {
    dados <- df
  }
}
return(dados)
}

novo <- list(parametro1 = c("FCESP12_IIC12"), 
             parametro2 =  c("Índice de confiança do consumidor (ICC)"))


ICC <- dados_ipea(novo) %>% 
  mutate(date = format(date, "%Y-%m"))

hchart(ICC, type = "line", hcaes(x = date, y = ICC$`Índice de confiança do consumidor (ICC)`)) %>%
  hc_title(text = "Índice de confiança do consumidor") %>%
  hc_subtitle(text = "Fonte: Fecomercio SP") %>%
  hc_credits(text = "Ipeadata: FCESP12_IIC12") %>% 
  hc_yAxis(title = list(text = "ICC")) %>% 
  hc_xAxis(title = list(text = " "))
  




```

<div class="spacer"></div>
