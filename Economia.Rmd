---
title: "DADOS DA ECONOMIA BRASILEIRA"
output: 
  bookdown::html_document2:
    theme: lumen
    split_by: "section"
    fig_width: 7
    fig_height: 6
    fig_caption: true
    number_sections: false 
    toc: yes
    toc_depth: 3
    toc_float:
        collapsed: no
        smooth_scroll: yes
    css: "style.css"
date: "Atualizado em `r Sys.setlocale('LC_TIME', 'Portuguese_Brazil') ; format(Sys.time(), format = '%d de %B de %Y')`"
---
<!-- Inclua a biblioteca Font Awesome -->
<script src="https://kit.fontawesome.com/4e10600d5e.js" crossorigin="anonymous"></script>

<!-- Carregando fontes -->
<style>
  @@import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap');
</style>

<!-- Configuração do corpo do site -->
<style>
  body {
    text-align: justify;
    line-height: 1.5;
    font-family: 'Nunito Sans', sans-serif;
    
  }

/* Estilos para telas menores que 600 pixels de largura */
@media only screen and (max-width: 600px) {
  body {
    margin-left: 0; /* Remove o recuo na margem esquerda para telas menores */
    font-size: 2rem;
  }

  .dataTables_wrapper .dataTables_length,
  .dataTables_wrapper .dataTables_filter,
  .dataTables_wrapper .dataTables_info,
  .dataTables_wrapper .dataTables_paginate {
    font-size: 0.8rem;
    font-family: 'Nunito Sans', sans-serif;
    color: #636363;
  
  }
}

/* Estilos específicos para os títulos e parágrafos no conteúdo do documento */
  h1 {
    color: #0066cc; /* Azul para títulos de nível 1 */
    font-size: 4rem;
    font-family: "Bebas Neue", sans-serif;
  }
  
  h2 {
    color: #3399ff; /* Azul claro para títulos de nível 2 */
    font-size: 2rem;
    font-family: "Bebas Neue", sans-serif;
  }
  
  h3 {
    color: #66b2ff; /* Azul ainda mais claro para títulos de nível 3 */
    font-size: 2rem;
    font-family: "Bebas Neue", sans-serif;
  }
  
  p {
    font-size: 2rem;
    font-family: 'Nunito Sans', sans-serif;
  }

</style>

<!-- Configuração dual-frames -->
<style>
  .dual-frames {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
  }

  .frame {
    width: 48%;
    border: 0.2rem solid #ddd;
    padding: 0.8rem;
    box-sizing: border-box;
    font-size: 1rem; /* Exemplo de tamanho de fonte para os quadros usando unidades relativas */

    /* Adicione uma margem inferior para espaçamento entre os quadros */
    margin-bottom: 1em;
  }

  /* Estilos para telas menores que 600 pixels de largura */
  @media only screen and (max-width: 600px) {
  body {
    margin-left: 0; /* Remove o recuo na margem esquerda para telas menores */
    font-size: 2rem;
    }
  }
</style>


```{r include=FALSE}

#carregando pacotes
library(bookdown)
library(sidrar)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(lubridate)
library(knitr)
library(kableExtra)
library(DT)
library(forcats)
library(plotly)
library(highcharter)
library(GetBCBData)

```

# BRASIL

Dados referentes a economia brasileira. Dados para auxiliar a entender a conjuntura econômica do nosso país.

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

df.bcb <- gbcbd_get_series(id = 21774 ,
                       first.date = '1900-01-01',
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE) %>% 
  mutate(populacao = value * 1000)



hchart(df.bcb, "column", hcaes(x = ref.date, y = populacao)) %>%
   hc_yAxis(
    title = list(text = "População"),
    labels = list(
      formatter = JS(
        "function() { 
          if (this.value >= 1e6) {
            return Highcharts.numberFormat(this.value / 1e6, 0) + ' MM';
          } else {
            return Highcharts.numberFormat(this.value, 0, '.', ',');
          }
        }"
      )
    )
  ) %>%
  hc_xAxis(title = list(text = "Data")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "População brasileira") %>%
  hc_subtitle(text = "Fonte: IBGE") %>%
  hc_tooltip(
    useHTML = TRUE,
    headerFormat = "<span style='font-size:10px'>{point.key}</span><table>",
    pointFormat = "<tr><td style='color:{point.color};padding:0'>{series.name}: </td><td style='padding:0'><b>{point.y:,.0f} pessoas</b></td></tr>",
    footerFormat = "</table>",
    shared = TRUE,
    valueDecimals = 2
  )


```

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>


```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))

## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

for (i in 1402:1406) {
  x <- bcb.sgs(i, '1900-01-01') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "Brasil - Comercial", 
    "Brasil - Residencial",
    "Brasil - Industrial",
    "Brasil - Outros",
    "Brasil - Total")

df.bcb <- df.bcb %>%
  pivot_longer(cols = -data, names_to = "variavel", values_to = "valor")

## Plotando gráficos
hchart(df.bcb, "line", hcaes(x = data, y = valor, group = variavel)) %>%
  hc_title(text = "Consumo de energia elétrica") %>%
  hc_subtitle(text = "Fonte: Eletrobras") %>%
  hc_xAxis(title = list(text = "Meses",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_yAxis(title = list(text = "Gigawatts-hora",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_legend(enabled = TRUE)


```


## PRODUTO {.toc}

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

As métricas de produto buscam mensurar quantidade de riqueza gerada em um país, estado ou cidade, dentro de um período de tempo.

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

### Produto Interno Bruto {.toc}

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

O Produto Interno Bruto (PIB - *GDP/Gross Domestic Product*) é a soma de todos os bens e serviços finais produzidos por um país, estado ou cidade, geralmente em um ano.

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>
<div class="dual-frames">
<div class="frame">
*The Organisation for Economic Co-operation and Development ([OECD](https://en.wikipedia.org/wiki/OECD)) defines GDP as "an aggregate measure of production equal to the sum of the gross values added of all resident and institutional units engaged in production and services (plus any taxes, and minus any subsidies, on products not included in the value of their outputs)"*
</div>
<div class="frame">
*An [IMF](https://en.wikipedia.org/wiki/International_Monetary_Fund) publication states that, "GDP measures the monetary value of final goods and services—that are bought by the final user—produced in a country in a given period (say a quarter or a year)."*
</div>
</div>
<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

Existem três metodologias de cálculo do PIB, sendo que teoricamente todas elas chegam ao mesmo valor final.

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

**Ótica da oferta ou produção**

Também conhecida como *método do valor adicionado*, calcula o montante que cada estágio da produção agrega ao produto. Primeiro estima-se o do *valor adicionado bruto* fabricado das diversas atividades econômicas.Posteriormente estima-se o valor do *consumo intermediário*, onde considera os custos dos bens e serviços utilizados para produzir os bens e serviços finais. Ademais, subtrai o valor doméstico bruto do valor intermediário. Por fim, *subtrai os valores dos impostos indiretos e soma os valores dos subsídios*. 

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

**Ótica da renda**

O método inicia com o somatório dos *salários, vencimentos e rendimentos* recebidos pelas atividades laborais, *juros e receitas* advindos de diversos investimentos, *aluguéis* referentes aos alugueis/arrendamentos de imóveis ou terras, *lucros corporativos* oriundos dos lucros das empresas e *lucros líquidos* das transferências dos lucros das empresas para as pessoas.
Este somatório resulta no rendimento doméstico líquido dos custos dos fatores.
Para chegar ao PIB, deve-se ainda considerar a *deprecisação do capital*, as *taxas de produção e importação* e os *subsídios* estatais. 

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

**Ótica do consumo**

Essa é a metologia mais divulgada onde o PIB é mesurado pela soma do *consumo (C)*, *investimento (I)*, *gastos do governo (G)* e *balança comercial (X-M)*. Por este método utiliza os preços de aquisição dos bens e serviços finais. Quando não realizada a venda, a contabilidade considera que o produtor comprou de si mesmo. 

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

*DADOS [BACEN SGS](https://www3.bcb.gov.br/sgspub/localizarseries/localizarSeries.do?method=prepararTelaLocalizarSeries)*

**PIB - acumulado dos últimos 12 meses - Em US$ milhões - BCB SGS 4192**

Oficialmente o IBGE calcula trimestralmente o PIB , entretanto, devido a utilização deste agregado econômico para formulação de políticas públicas e demais necessidades, o Departamento Econômico do Banco Central estima o PIB por meio da interpolação com dados já divulgados, realizando extrapolação do último valor divulgado do PIB Nominal, sofrendo revisões periódicas.

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

df.bcb <- gbcbd_get_series(id = 4192 ,
                       first.date = '1900-01-01',
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)

hchart(df.bcb, "column", hcaes(x = ref.date, y = value)) %>%
  hc_yAxis(title = list(text = "US$ milhões")) %>%
  hc_xAxis(title = list(text = "Data")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_subtitle(text = "Fonte: BCB - Depec")  %>%
  hc_tooltip(
    useHTML = TRUE,
    headerFormat = "<span style='font-size:10px'>{point.key}</span><table>",
    pointFormat = "<tr><td style='color:{point.color};padding:0'>{series.name}: </td><td style='padding:0'><b>{point.y:.0f} MM US$</b></td></tr>",
    footerFormat = "</table>",
    shared = TRUE,
    valueDecimals = 2
  )


```

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

**PIB per capita - US$ correntes - 21776**

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

df.bcb <- gbcbd_get_series(id = 21776 ,
                       first.date = '1900-01-01',
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)

hchart(df.bcb, "column", hcaes(x = ref.date, y = value)) %>%
  hc_yAxis(title = list(text = "US$",
                        labels = list(
      formatter = JS(
        "function() { 
          return Highcharts.numberFormat(this.value, 0, '.', ',');
        }"
          )
  ) )) %>%
  hc_xAxis(title = list(text = "Data")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_subtitle(text = "Fonte: BCB - Depec")  %>%
  hc_tooltip(
    useHTML = TRUE,
    headerFormat = "<span style='font-size:10px'>{point.key}</span><table>",
    pointFormat = "<tr><td style='color:{point.color};padding:0'>{series.name}: </td><td style='padding:0'><b>{point.y:.0f} US$</b></td></tr>",
    footerFormat = "</table>",
    shared = TRUE,
    valueDecimals = 2
  )

```

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

**PIB - taxa de variação real no ano - 7326 | 7327 |7328 | 7329**

```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))

## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

for (i in 7326:7329) {
  x <- bcb.sgs(i, '1900-01-01') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "PIB - taxa de variação real no ano", 
    "PIB agropecuária - taxa de variação real no ano",
    "PIB indústria - taxa de variação real no ano",
    "PIB serviços - taxa de variação real no ano")

df.bcb <- df.bcb %>%
  pivot_longer(cols = -data, names_to = "variavel", values_to = "valor")

## Plotando gráficos
hchart(df.bcb, "line", hcaes(x = data, y = valor, group = variavel)) %>%
  hc_title(text = " ") %>%
  hc_subtitle(text = "FONTE: IBGE") %>%
  hc_xAxis(title = list(text = "Anos")) %>%
  hc_yAxis(title = list(text = "Variação % anual",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_legend(enabled = TRUE)


```

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

**PIB - Preços correntes de 1990 - 1207**

Os dados das Contas Nacionais Trimestrais (CNT), a preços constantes de 1990, são apresentados em uma série encadeada de índices de volume. Os dados são compilados pelo método da produção e cobrem toda a economia brasileira. O PIB em preços correntes mede o valor total de bens e serviços para uso final produzidos durante o trimestre antes da dedução do consumo de capital fixo.


```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

df.bcb <- gbcbd_get_series(id = 1207 ,
                       first.date = '1990-01-01',
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)

hchart(df.bcb, "column", hcaes(x = ref.date, y = value)) %>%
  hc_yAxis(title = list(text = "RS",
                        labels = list(
                          formatter = JS(
                            "function() { 
                              return Highcharts.numberFormat(this.value, 0, '.', ',');
                            }"
                          )
                        )
  )) %>%
  hc_xAxis(title = list(text = "Data")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_subtitle(text = "Fonte: IBGE")  %>%
  hc_tooltip(
    useHTML = TRUE,
    headerFormat = "<span style='font-size:10px'>{point.key}</span><table>",
    pointFormatter = JS(
      "function() {
        return '<tr><td style=\"color:' + this.color + ';padding:0\">' + this.series.name + ': </td>' +
               '<td style=\"padding:0\"><b>' + (this.y / 1e12).toFixed(2) + ' T R$</b></td></tr>';
      }"
    ),
    footerFormat = "</table>",
    shared = TRUE,
    valueDecimals = 2
  )

```

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

## MOEDA {.toc}



### Inflação {.toc .tabset .tabset-fade .tabset-pills} 

É o aumento generalizado e persistente do nível de preços de uma economia.

**Causas da inflação**

A inflação pode ter várias causas, que podem ser agrupadas em:

- Pressões de demanda
- Pressões de custos
- Inércia inflacionária
- Expectativas de inflação

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

**Consequências da inflação**

A inflação descontrolada gera incertezas importantes na economia, desestimulando o investimento e, assim, prejudicando o crescimento econômico. Os preços relativos ficam distorcidos, gerando várias ineficiências na economia. As pessoas e as firmas perdem noção dos preços relativos e, assim, fica difícil avaliar se algo está barato ou caro. A inflação afeta particularmente as camadas menos favorecidas da população, pois essas têm menos acesso a instrumentos financeiros para se defender da inflação.

Inflação mais alta também aumenta o custo da dívida pública, pois as taxas de juros da dívida pública têm de compensar não só o efeito da inflação mas também têm de incluir um prêmio de risco para compensar as incertezas associadas com a inflação mais alta.

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

**Por que a deflação é também indesejável?**

O Banco Central trabalha para manter a inflação baixa – não para que os preços declinem. A perspectiva de que os valores cobrados sejam relativamente estáveis ao longo do tempo, com inflação baixa e previsível, é importante para o planejamento de todos. Ao contrário do que possa parecer, preços em queda podem ser prejudiciais para o bom funcionamento da economia. Um comerciante poderá ter prejuízo se ganhar menos amanhã pelo estoque que fez hoje. As famílias e as empresas poderão adiar suas decisões de consumo e investimento se houver a perspectiva de que os preços serão mais baixos amanhã, deprimindo a atividade econômica.

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

#### IPCA {.tabset .tabset-fade .tabset-pills}
<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>
O IPCA mede a variação de preços de uma cesta de produtos e serviços consumida pela população. O resultado mostra se os preços aumentaram ou diminuíram de um mês para o outro.

A cesta é definida pela [Pesquisa de Orçamentos Familiares](https://www.ibge.gov.br/estatisticas/sociais/populacao/24786-pesquisa-de-orcamentos-familiares-2.html?utm_source=landing&utm_medium=explica&utm_campaign=inflacao) - POF, do IBGE, que, entre outras questões, verifica o que a população consome e quanto do rendimento familiar é gasto em cada produto: arroz, feijão, passagem de ônibus, material escolar, médico, cinema, entre outros.

O índice, portanto, leva em conta não apenas a variação de preço de cada item, mas também o peso que ele tem no orçamento das famílias.

Atualmente, a população-objetivo do IPCA abrange as famílias<span style="font-weight: bold; color: #ff6600;"> com rendimentos de 1 a 40 salários mínimos</span>, qualquer que seja a fonte, residentes nas áreas urbanas das regiões de abrangência do SNIPC, as quais são: regiões metropolitanas de Belém, Fortaleza, Recife, Salvador, Belo Horizonte, Vitória, Rio de Janeiro, São Paulo, Curitiba, Porto Alegre, além do Distrito Federal e dos municípios de Goiânia, Campo Grande, Rio Branco, São Luís e Aracaju.

##### Índice {.tabset .tabset-fade .tabset-pills}

[Tabela 1337](https://sidra.ibge.gov.br/tabela/1737)

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100vw'}

sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

IPCA <- sidra('/t/1737/n1/all/v/63,2263,2264,2265/p/all/d/v63%202,v2263%202,v2264%202,v2265%202', format(Sys.Date() - months(120), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, desc(Data))
colnames(IPCA) <- c("Data", "Mensal", "3 meses", "6 meses", "12 meses")

datatable(IPCA, options = list(
  pageLength = 10,
  autoWidth = TRUE,
  columnDefs = list(list(className = 'dt-center', targets = '_all'))
), caption = "VARIAÇÃO MENSAL E ACUMULADA", width = "100%", class = "display nowrap")


```

###### Mensal

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y) {
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
}

# Obtendo dados
IPCA <- sidra('/t/1737/n1/all/v/63,2263,2264,2265/p/all/d/v63%202,v2263%202,v2264%202,v2265%202', format(Sys.Date() - months(24), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, Data)
colnames(IPCA) <- c("Data", "Mensal", "3 meses", "6 meses", "12 meses")

# Criando o gráfico com highcharter
hchart(IPCA, "column", hcaes(x = Data, y = Mensal, color = ifelse(Mensal > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")

```

###### 3 meses

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}
# Função sidra
sidra <- function(z, y) {
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
}

# Criar dados iniciais
IPCA <- sidra('/t/1737/n1/all/v/63,2263,2264,2265/p/all/d/v63%202,v2263%202,v2264%202,v2265%202', format(Sys.Date() - months(24), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, desc(Data))
colnames(IPCA) <- c("Data", "Mensal", "3 meses", "6 meses", "12 meses")

hchart(IPCA, "column", hcaes(x = Data, y = `3 meses`, color = ifelse(`3 meses` > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")
```

###### 6 meses

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}
sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

IPCA <- sidra('/t/1737/n1/all/v/63,2263,2264,2265/p/all/d/v63%202,v2263%202,v2264%202,v2265%202', format(Sys.Date() - months(60), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, Data)
colnames(IPCA) <- c("Data", "Mensal", "3 meses", "6 meses", "12 meses")

IPCA_semestral <- IPCA %>% select(Data, `6 meses`) %>% 
  mutate(cor = ifelse(`6 meses`>0, "azul", "vermelho"))

IPCA_semestral$Data <- as.Date(paste0(IPCA_semestral$Data, "-01"), format = "%Y-%m-%d")

hchart(IPCA, "column", hcaes(x = Data, y = `6 meses`, color = ifelse(`6 meses` > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")
```

###### 12 meses 

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}
sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

IPCA <- sidra('/t/1737/n1/all/v/63,2263,2264,2265/p/all/d/v63%202,v2263%202,v2264%202,v2265%202', format(Sys.Date() - months(120), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, Data)
colnames(IPCA) <- c("Data", "Mensal", "3 meses", "6 meses", "12 meses")

IPCA_anual <- IPCA %>% select(Data, `12 meses`) %>% 
  mutate(cor = ifelse(`12 meses`>0, "azul", "vermelho"))

IPCA_anual$Data <- as.Date(paste0(IPCA_anual$Data, "-01"), format = "%Y-%m-%d")

hchart(IPCA, "column", hcaes(x = Data, y = `12 meses`, color = ifelse(`12 meses` > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")
```

##### Grupos {.tabset .tabset-fade .tabset-pills}

- Os gráficos apresentados são referentes aos grupos da cesta que é definida pela Pesquisa de Orçamentos Familiares. 
- Com estes dados é possível identificar quais grupos sofreram maiores mudanças nos níveis de preços no período analisado.

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

grupos_box <- get_sidra(api = '/t/7060/n1/all/v/63/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v63%202')


ggplot(grupos_box, aes(x = Valor, y = fct_rev(`Geral, grupo, subgrupo, item e subitem`), fill = `Geral, grupo, subgrupo, item e subitem`)) +
  geom_boxplot() +
  scale_fill_hue(direction = 1)  +
  labs(
    x = element_text("Valor", face = "bold"),
    y = element_text("Geral, grupo, subgrupo, item e subitem", face = "bold"),
    fill = "Cores"
  )  +
  ggtitle("BOXPLOT - VARIAÇÃO MENSAL DESDE JAN-2020") +
  theme_light()+
  theme(legend.position = "none")
  

```

###### Mensal

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

grupos_mensal <- get_sidra(api = '/t/7060/n1/all/v/63/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v63%202') %>%   
  mutate(
    cor = ifelse(Valor > 0, "#82C35F", "#E75A5A"),
    Mês = as.Date(paste0(Mês, "01"), format = "%Y%m%d")
  ) %>% 
  filter(`Mês (Código)` == max(`Mês (Código)`))

plot_ly(data = grupos_mensal, 
        x = ~Valor, 
        y = ~fct_rev(`Geral, grupo, subgrupo, item e subitem`), 
        type = "bar", 
        marker = list(color = ~cor)) %>% 
  layout(
    xaxis = list(title = "Valor"),
    yaxis = list(title = "Geral, grupo, subgrupo, item e subitem"),
    title = "VARIAÇÃO MENSAL",
    showlegend = FALSE
  )

```

###### Acumulada em 12 meses

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

grupos_mensal <- get_sidra(api = '/t/7060/n1/all/v/2265/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v2265%202') %>%   mutate(
    cor = ifelse(Valor > 0, "#82C35F", "#E75A5A"),
    Mês = as.Date(paste0(Mês, "01"), format = "%Y%m%d"),
    )  %>% 
  filter(`Mês (Código)` == max(`Mês (Código)`))

plot_ly(data = grupos_mensal, 
        x = ~Valor, 
        y = ~fct_rev(`Geral, grupo, subgrupo, item e subitem`), 
        type = "bar", 
        marker = list(color = ~cor)) %>% 
  layout(
    xaxis = list(title = "Valor"),
    yaxis = list(title = "Geral, grupo, subgrupo, item e subitem"),
    title = "VARIAÇÃO ACUMULADA EM 12 MESES",
    showlegend = FALSE
  )

```

###### Pesos dos grupos

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

pesos <- get_sidra(api = '/t/7060/n1/all/v/66/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v66%204') %>%   
  mutate(
    `Mês (Código)` = ymd(paste0(`Mês (Código)`, "01"))
  ) %>% 
  filter(`Mês (Código)` >= max(`Mês (Código)`) - months(6) + 1)

# Usando plot_ly para criar um gráfico de barras
plot_ly(pesos, x = ~`Mês (Código)`, y = ~Valor, type = "bar", color = ~fct_rev(`Geral, grupo, subgrupo, item e subitem`), colors = "Dark2") %>%
  layout(
    xaxis = list(title = " ", titlefont = list(size = 14, color = "black")),
    yaxis = list(title = "Pesos dos grupos", titlefont = list(size = 14, color = "black")),
    barmode = "stack",
    title = "Pesos ou participações dos grupos na cesta",
    showlegend = TRUE
  )


```

##### Localidade

#### INPC {.tabset .tabset-fade .tabset-pills}
<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>
O INPC verifica a variação do custo de vida médio apenas de famílias<span style="font-weight: bold; color: #ff6600;"> com renda mensal de 1 a 5 salários mínimos</span>. Esses grupos são mais sensíveis às variações de preços, pois tendem a gastar todo o seu rendimento em itens básicos, como alimentação, medicamentos, transporte etc

O propósito do INPC e IPCA são o mesmo: medir a variação de preços de uma cesta de produtos e serviços consumida pela população. O resultado mostra se os preços aumentaram ou diminuíram de um mês para o outro.

A cesta de ambos é definida pela [Pesquisa de Orçamentos Familiares](https://www.ibge.gov.br/estatisticas/sociais/populacao/24786-pesquisa-de-orcamentos-familiares-2.html?utm_source=landing&utm_medium=explica&utm_campaign=inflacao) - POF, do IBGE, que, entre outras questões, verifica o que a população consome e quanto do rendimento familiar é gasto em cada produto: arroz, feijão, passagem de ônibus, material escolar, médico, cinema, entre outros.

Os índices, portanto, levam em conta não apenas a variação de preço de cada item, mas também o peso que ele tem no orçamento das famílias.

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

[Tabela 7063](https://sidra.ibge.gov.br/tabela/7063)

##### Índice {.tabset .tabset-fade .tabset-pills}

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

IPCA <- sidra('/t/7063/n1/all/v/44/p/all/c315/7169/d/v44%202', format(Sys.Date() - months(120), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, desc(Data))
colnames(IPCA) <- c("Data", "Mensal", "3 meses", "6 meses", "12 meses")

datatable(IPCA, options = list(pageLength = 10, autoWidth = TRUE, columnDefs = list(list(className = 'dt-center', targets = '_all'))), caption = "VARIAÇÃO MENSAL E ACUMULADA")


```

###### Mensal

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y) {
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
}

# Obtendo dados
IPCA <- sidra('/t/7063/n1/all/v/44/p/all/c315/7169/d/v44%202', format(Sys.Date() - months(24), "%Y-%m")) %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, Data)
colnames(IPCA) <- c("Data", "Mensal", "3 meses", "6 meses", "12 meses")

# Criando o gráfico com highcharter
hchart(IPCA, "column", hcaes(x = Data, y = Mensal, color = ifelse(Mensal > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")

```

###### 12 meses 

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}
sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`, `Variável`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor, `Variável`) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

IPCA <- sidra('/t/7063/n1/all/v/2292/p/all/c315/7169/d/v2292%202', "2020-12") %>% 
  pivot_wider(names_from = "Variável", values_from = "Valor")

IPCA <- arrange(IPCA, Data)
colnames(IPCA) <- c("Data", "12 meses")

IPCA_anual <- IPCA %>% select(Data, `12 meses`) %>% 
  mutate(cor = ifelse(`12 meses`>0, "azul", "vermelho"))

IPCA_anual$Data <- as.Date(paste0(IPCA_anual$Data, "-01"), format = "%Y-%m-%d")

hchart(IPCA, "column", hcaes(x = Data, y = `12 meses`, color = ifelse(`12 meses` > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")
```

##### Grupos {.tabset .tabset-fade .tabset-pills}

- Os gráficos apresentados são referentes aos grupos da cesta que é definida pela Pesquisa de Orçamentos Familiares. 
- Com estes dados é possível identificar quais grupos sofreram maiores mudanças nos níveis de preços no período analisado.

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

grupos_box <- get_sidra(api = '/t/7063/n1/all/v/44/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v44%202')


ggplot(grupos_box, aes(x = Valor, y = fct_rev(`Geral, grupo, subgrupo, item e subitem`), fill = `Geral, grupo, subgrupo, item e subitem`)) +
  geom_boxplot() +
  scale_fill_hue(direction = 1)  +
  labs(
    x = element_text("Valor", face = "bold"),
    y = element_text("Geral, grupo, subgrupo, item e subitem", face = "bold"),
    fill = "Cores"
  )  +
  ggtitle("BOXPLOT - VARIAÇÃO MENSAL DESDE JAN-2020") +
  theme_light()+
  theme(legend.position = "none")
  

```

###### Mensal

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

grupos_mensal <- get_sidra(api = '/t/7063/n1/all/v/44/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v44%202') %>%   
  mutate(
    cor = ifelse(Valor > 0, "#82C35F", "#E75A5A"),
    Mês = as.Date(paste0(Mês, "01"), format = "%Y%m%d")
  ) %>% 
  filter(`Mês (Código)` == max(`Mês (Código)`))

plot_ly(data = grupos_mensal, 
        x = ~Valor, 
        y = ~fct_rev(`Geral, grupo, subgrupo, item e subitem`), 
        type = "bar", 
        marker = list(color = ~cor)) %>% 
  layout(
    xaxis = list(title = "Valor"),
    yaxis = list(title = "Geral, grupo, subgrupo, item e subitem"),
    title = "VARIAÇÃO MENSAL",
    showlegend = FALSE
  )

```

###### Acumulada em 12 meses

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

grupos_mensal <- get_sidra(api = '/t/7063/n1/all/v/2292/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v2292%202') %>%   mutate(
    cor = ifelse(Valor > 0, "#82C35F", "#E75A5A"),
    Mês = as.Date(paste0(Mês, "01"), format = "%Y%m%d"),
    )  %>% 
  filter(`Mês (Código)` == max(`Mês (Código)`))

plot_ly(data = grupos_mensal, 
        x = ~Valor, 
        y = ~fct_rev(`Geral, grupo, subgrupo, item e subitem`), 
        type = "bar", 
        marker = list(color = ~cor)) %>% 
  layout(
    xaxis = list(title = "Valor"),
    yaxis = list(title = "Geral, grupo, subgrupo, item e subitem"),
    title = "VARIAÇÃO ACUMULADA EM 12 MESES",
    showlegend = FALSE
  )

```

###### Pesos dos grupos

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

pesos <- get_sidra(api = '/t/7063/n1/all/v/45/p/all/c315/7170,7445,7486,7558,7625,7660,7712,7766,7786/d/v45%204') %>%   
  mutate(
    `Mês (Código)` = ymd(paste0(`Mês (Código)`, "01"))
  ) %>% 
  filter(`Mês (Código)` >= max(`Mês (Código)`) - months(6) + 1)

# Usando plot_ly para criar um gráfico de barras
plot_ly(pesos, x = ~`Mês (Código)`, y = ~Valor, type = "bar", color = ~fct_rev(`Geral, grupo, subgrupo, item e subitem`), colors = "Dark2") %>%
  layout(
    xaxis = list(title = " ", titlefont = list(size = 14, color = "black")),
    yaxis = list(title = "Pesos dos grupos", titlefont = list(size = 14, color = "black")),
    barmode = "stack",
    title = "Pesos ou participações dos grupos na cesta",
    showlegend = TRUE
  )


```

##### Localidade


#### IPGM

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

O indicador foi concebido no final dos anos de 1940 para ser uma medida abrangente do movimento de preços, que englobasse não apenas diferentes atividades como também etapas distintas do processo produtivo. Dessa forma, o IGP é um indicador mensal do nível de atividade econômica do país, englobando seus principais setores.

O cálculo do indicador, assim como os outros dois indicadores (IGP-10 e IGP-DI), tem em conta a variação de preços de bens e serviços, bem como de matérias-primas utilizadas na produção agrícola, industrial e construção civil. Dessa forma, o resultado do IGP-M é a <span style="font-weight: bold; color: #ff6600;">média aritmética ponderada da inflação ao produtor (IPA), consumidor (IPC) e construção civil (INCC)</span>.

- Índice de Preços ao Produtor Amplo (IPA);
- Índice de Preços ao Consumidor (IPC);
- Índice Nacional de Custo da Construção (INCC).

Os pesos de cada um dos índices componentes correspondem a parcelas da despesa interna bruta, calculadas com base nas Contas Nacionais – resultando na seguinte distribuição:

- 60% para o IPA;
- 30% para o IPC;
- 10% para o INCC.

Nesse contexto, o IPA é o indicador que monitora a variação de preços percebidos por produtores, ao passo que o IPC acompanha o comportamento dos preços que impactam diretamente o consumidor final. Por fim, o INCC apresenta os custos para a construção civil, em uma análise que leva em conta a variação de preços de materiais de construção e custo de mão de obra especializada.

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))


## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

## Tabelas do BCB SGS
I <-  c(7450,7456,7453,189)

for (i in I) {
  x <- bcb.sgs(i, '1900-01-01') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "IPA-M", 
    "INCC-M",
    "IPC-M",
    "IGP-M")

df.bcb_longer <- df.bcb %>%
  pivot_longer(cols = -data, names_to = "variavel", values_to = "valor")

## Plotando gráficos
hchart(df.bcb_longer, "line", hcaes(x = data, y = valor, group = variavel)) %>%
  hc_title(text = " ") %>%
  hc_subtitle(text = "Fonte: FGV") %>%
  hc_xAxis(title = list(text = "Meses",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_yAxis(title = list(text = "Percentual",
                        style = list(fontWeight = "bold",
                                     fontsize = "2rem"))) %>%
  hc_legend(enabled = TRUE)


```

<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

```{r results='asis', engine='R', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

## problemas com codificacao existentes, setado para rodar apenas nesse chunk
invisible(Sys.setlocale("LC_CTYPE", "en_US.UTF-8"))


## funcao para obter dados do bacen sgs
bcb.sgs <- function(x,y){
  gbcbd_get_series(id = x ,
                       first.date = y,
                       last.date = Sys.Date(),
                       format.data = 'long',
                       use.memoise = TRUE, 
                       cache.path = tempdir(), # use tempdir for cache folder
                       do.parallel = FALSE)
}

## capturando e tratando dados
df.bcb <- data.frame()

## Tabelas do BCB SGS
I <-  c(7450,7456,7453,189)

for (i in I) {
  x <- bcb.sgs(i, '1900-01-01') %>% 
    select(ref.date, value)
  colnames(x)[2] <- as.character(i)
  
  if (nrow(df.bcb) == 0) {
    df.bcb <- x
  } else {
    df.bcb <- merge(df.bcb, x, by = "ref.date")
  }
}

colnames(df.bcb) <- c("data",
    "IPA-M", 
    "INCC-M",
    "IPC-M",
    "IGP-M")

# Crie um segundo dataframe para armazenar as variações anuais
df.bcb_MENSAL <- cbind(df.bcb[, 1],((df.bcb[, 2:5] /100) + 1))

# Criar um dataframe vazio para df.bcb_anual
df.bcb_anual <- df.bcb_MENSAL

# Loop para calcular a variação anual para cada coluna
for (i in 2:5) {
  col_nome <- paste0(colnames(df.bcb_MENSAL)[i], "_anual")

  # Inicializar a coluna com NA se ainda não existir
  if (!(col_nome %in% colnames(df.bcb_anual))) {
    df.bcb_anual[[col_nome]] <- NA
  }

  for (j in 12:nrow(df.bcb_MENSAL)) {
    df.bcb_anual[[col_nome]][j] <- (prod(df.bcb_MENSAL[[i]][j:(j-11)]) - 1) * 100
  }
}

df.bcb_anual <- df.bcb_anual[12:nrow(df.bcb_anual),c(1,6:9)]

colnames(df.bcb_anual) <- c("data",
    "IPA-M", 
    "INCC-M",
    "IPC-M",
    "IGP-M")

df.bcb_anual <- df.bcb_anual %>% 
  select(data, `IGP-M`, `IPA-M`,`IPC-M`,`INCC-M`)

df.bcb_anual <- arrange(df.bcb_anual, desc(data)) %>% 
  mutate(data = format(data, "%b-%Y"))

colunas_para_formatar <- colnames(df.bcb_anual)[2:5]

datatable(df.bcb_anual, options = list(
  pageLength = 10,
  autoWidth = TRUE,
  columnDefs = list(list(className = 'dt-center', targets = '_all'))
), caption = "Variação percentual anual", width = "100%", class = "display nowrap") %>% 
  formatRound(
    columns = colunas_para_formatar,
    digits = 2
  )


```


<style>
  .spacer {
    height: 2rem; /* Ajuste conforme necessário para o tamanho desejado */
  }
</style>

<div class="spacer"></div>

### Juros {.toc} 

selic

### Estoque {.toc} 

m1

### B. pagamentos {.toc} 

tabela dos saldos

## GOVERNO {.toc}

### Defict fiscal {.toc} 

### Emissão de dívidas {.toc} 

## MERCADO NACIONAL {.toc}

### CAGED {.toc} 

### PNAD {.toc} 

### PMC {.toc .tabset .tabset-fade .tabset-pills}

A Pesquisa Mensal do Comércio - PMC é uma pesquisa por amostragem probabilística, realizada em todas as Unidades da Federação.

O objetivo contemplado no desenho da amostra é a obtenção de estimativas dos totais populacionais referentes à variável receita bruta de revenda, por Unidade da Federação e por atividade PMC, utilizadas para construir os indicadores da pesquisa que são divulgados mensalmente. A unidade de investigação da PMC é a empresa, sendo também a unidade amostral, ou seja, a unidade utilizada para a seleção e expansão da amostra.

As séries da PMC ajustadas sazonalmente consideram como fatores sazonais, o efeito calendário, os feriados de Carnaval, Páscoa e Corpus Christi além da identificação de outliers. Os cálculos são feitos utilizando-se o software X12 ARIMA, do U.S. Census Bureau.

#### COMÉRCIO VAREJISTA {.tabset .tabset-fade .tabset-pills}

- Refere-se à venda de bens e serviços diretamente ao consumidor final para uso pessoal ou doméstico.
- Inclui uma ampla gama de atividades, desde a venda de alimentos e vestuário até produtos eletrônicos, móveis e combustíveis, entre outros.
- As atividades do comércio varejista são monitoradas para avaliar a demanda do consumidor e a saúde geral da economia.

[Tabela 8880](https://sidra.ibge.gov.br/tabela/8880)

##### RECEITA

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

# Capturando os dados e tratando
PMC = sidra('/t/8880/n1/all/v/7169/p/all/c11046/56733/d/v7169%205', format(Sys.Date() - months(26), "%Y-%m")) %>% 
  rename(PMC = Valor) %>% 
  mutate(PMC_MENSAL = ((PMC / lag(PMC)-1) * 100 )) %>% 
  mutate(Cor = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A")) %>% 
  filter(Data >= format(Sys.Date() - months(25), "%Y-%m"))

#Plotando
hchart(PMC, "column", hcaes(x = Data, y = PMC_MENSAL, color = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")

```

##### VOLUME

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

#Capoturando e tratando dados
PMC = sidra('/t/8880/n1/all/v/7169/p/all/c11046/56734/d/v7169%205', format(Sys.Date() - months(26), "%Y-%m")) %>% 
  rename(PMC = Valor) %>% 
  mutate(PMC_MENSAL = ((PMC / lag(PMC)-1) * 100 )) %>% 
  mutate(Cor = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A")) %>% 
  filter(Data >= format(Sys.Date() - months(25), "%Y-%m"))

#protando resultado
hchart(PMC, "column", hcaes(x = Data, y = PMC_MENSAL, color = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")

```

#### COMÉRCIO VAREJISTA AMPLIADO {.tabset .tabset-fade .tabset-pills}

- Inclui todas as atividades do comércio varejista, mas vai além ao incorporar categorias adicionais relacionadas ao varejo.
- Normalmente, o comércio varejista ampliado pode incluir a venda de veículos, motocicletas, partes e peças; material de construção; e equipamentos e materiais para escritório, informática e comunicação, entre outros.
- Essa categoria é mais abrangente e oferece uma visão mais ampla do ambiente de varejo, incorporando setores que podem não estar diretamente relacionados ao consumo pessoal diário.

[Tabela 8881](https://sidra.ibge.gov.br/tabela/8881)

##### RECEITA

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

PMC = sidra('/t/8881/n1/all/v/7169/p/all/c11046/56735/d/v7169%205', format(Sys.Date() - months(26), "%Y-%m")) %>% 
  rename(PMC = Valor) %>% 
  mutate(PMC_MENSAL = ((PMC / lag(PMC)-1) * 100 )) %>% 
  mutate(Cor = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A")) %>% 
  filter(Data >= format(Sys.Date() - months(25), "%Y-%m"))

#Plotando
hchart(PMC, "column", hcaes(x = Data, y = PMC_MENSAL, color = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")
```

##### VOLUME

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}

sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

PMC = sidra('/t/8881/n1/all/v/7169/p/all/c11046/56736/d/v7169%205', format(Sys.Date() - months(26), "%Y-%m")) %>% 
  rename(PMC = Valor) %>% 
  mutate(PMC_MENSAL = ((PMC / lag(PMC)-1) * 100 )) %>% 
  mutate(Cor = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A")) %>% 
  filter(Data >= format(Sys.Date() - months(25), "%Y-%m"))

#Protando gráfico
hchart(PMC, "column", hcaes(x = Data, y = PMC_MENSAL, color = ifelse(PMC_MENSAL > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")

```

### PMS {.toc .tabset .tabset-fade .tabset-pills}

A Pesquisa Mensal de Serviços - PMS tem como objetivo produzir indicadores que permitam acompanhar o comportamento conjuntural dos principais segmentos empresariais não-financeiros do setor de serviços, excluindo-se os da saúde e da educação, complementando, através da análise de curto prazo, o mapeamento da estrutura das atividades de serviços no País, efetuado pela Pesquisa Anual de Serviços - PAS. 

[Tabela 5906](https://sidra.ibge.gov.br/tabela/5906)

#### RECEITA

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}
sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

PMS = sidra('/t/5906/n1/all/v/7167/p/all/c11046/56725/d/v7167%205', format(Sys.Date() - months(26), "%Y-%m")) %>% 
  rename(PMS = Valor) %>% 
  mutate(PMS_MENSAL = ((PMS / lag(PMS)-1) * 100 )) %>% 
  mutate(Cor = ifelse(PMS_MENSAL > 0, "#82C35F", "#E75A5A"))%>% 
  filter(Data >= format(Sys.Date() - months(25), "%Y-%m"))

hchart(PMS, "column", hcaes(x = Data, y = PMS_MENSAL, color = ifelse(PMS_MENSAL > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")

```

#### VOLUME

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.align='center', out.width='100%'}
sidra <- function(z, y)
{
  get_sidra(api = z) %>% 
    select(`Mês (Código)`, `Valor`) %>% 
    mutate(Data = as.Date(paste0(`Mês (Código)`, "01"), format = "%Y%m%d")) %>% 
    select(Data, Valor) %>% 
    mutate(Data = format(Data, "%Y-%m")) %>% 
    filter(Data >= y) 
    }

PMS = sidra('/t/5906/n1/all/v/7167/p/all/c11046/56726/d/v7167%205', format(Sys.Date() - months(26), "%Y-%m")) %>% 
  rename(PMS = Valor) %>% 
  mutate(PMS_MENSAL = ((PMS / lag(PMS)-1) * 100 )) %>% 
  mutate(Cor = ifelse(PMS_MENSAL > 0, "#82C35F", "#E75A5A"))%>% 
  filter(Data >= format(Sys.Date() - months(25), "%Y-%m"))

hchart(PMS, "column", hcaes(x = Data, y = PMS_MENSAL, color = ifelse(PMS_MENSAL > 0, "#82C35F", "#E75A5A"))) %>%
  hc_yAxis(title = list(text = "Variação %")) %>%
  hc_legend(enabled = FALSE) %>%
  hc_colors(c("#82C35F", "#E75A5A")) %>%
  hc_plotOptions(column = list(stacking = "normal")) %>%
  hc_title(text = "") %>%
  hc_tooltip(pointFormat = "<b>{point.y:.2f}%</b>")

```

### PMI {.toc} 

### Cielo {.toc}

### Carros {.toc}

